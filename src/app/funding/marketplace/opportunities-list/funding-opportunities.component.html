<!-- Public / Unauthenticated View -->
@if (!isAuthenticated()) {
<div class="min-h-screen bg-slate-50">
  <!-- Landing Header for Public Users -->
  <landing-header />

  <!-- Opportunities Header (Minimal Design) -->
  <app-opportunities-header></app-opportunities-header>

  <!-- Main Content Area -->
  <div class="bg-slate-50">
    <!-- Horizontal Advanced Filters -->
    <div class="bg-white border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6">
        <app-advanced-filters
          (fundingTypeChange)="onFundingTypeChange($event)"
          (industryChange)="onIndustryChange($event)"
          (currencyChange)="onCurrencyChange($event)"
          (minAmountChange)="onMinAmountChange($event)"
          (maxAmountChange)="onMaxAmountChange($event)"
          (applyFilters)="applyFilters()"
          (clearFilters)="clearFilters()"
        >
        </app-advanced-filters>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 lg:px-8 py-8">
      <!-- Loading State -->
      <app-loading-state *ngIf="isLoading()"></app-loading-state>

      <!-- Empty State -->
      <app-empty-state
        *ngIf="!isLoading() && filteredOpportunities().length === 0"
        (clearFilters)="clearFilters()"
      >
      </app-empty-state>

      <!-- Opportunities Grid -->
      <app-opportunities-grid
        *ngIf="!isLoading() && filteredOpportunities().length > 0"
        #opportunitiesGrid
        [opportunities]="filteredOpportunities()"
        [userType]="getUserTypeLabel()"
        [canApply]="canApplyToOpportunity()"
        (apply)="applyToOpportunity($event)"
        (viewDetails)="viewOpportunityDetails($event)"
        (manage)="manageApplications($event)"
        (signInToApply)="redirectToLogin()"
      >
      </app-opportunities-grid>
    </div>
  </div>

  <!-- Landing Footer for Public Users -->
  <landing-footer />
</div>
}

<!-- Authenticated View -->
@if (isAuthenticated() && !isUserFunder()) {
<div class="min-h-screen bg-slate-50">
  <landing-header />

  <!-- Horizontal Advanced Filters -->
  <div class="bg-white border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6">
      <app-advanced-filters
        (fundingTypeChange)="onFundingTypeChange($event)"
        (industryChange)="onIndustryChange($event)"
        (currencyChange)="onCurrencyChange($event)"
        (minAmountChange)="onMinAmountChange($event)"
        (maxAmountChange)="onMaxAmountChange($event)"
        (applyFilters)="applyFilters()"
        (clearFilters)="clearFilters()"
      >
      </app-advanced-filters>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-8">
    <!-- Search and Stats Bar -->
    <app-search-stats-bar
      [searchQuery]="searchQuery()"
      [totalResults]="filteredOpportunities().length"
      [isLoading]="isLoading()"
      [showSmartSuggestions]="true"
      (searchChanged)="onSearchChange($event)"
      (refreshData)="refreshData()"
      (smartSuggestionsClick)="openSmartSuggestions()"
    >
    </app-search-stats-bar>

    <!-- Loading State -->
    <app-loading-state *ngIf="isLoading()"></app-loading-state>

    <!-- Empty State -->
    <app-empty-state
      *ngIf="!isLoading() && filteredOpportunities().length === 0"
      (clearFilters)="clearFilters()"
    >
    </app-empty-state>

    <!-- Opportunities Grid -->
    <app-opportunities-grid
      *ngIf="!isLoading() && filteredOpportunities().length > 0"
      #opportunitiesGrid
      [opportunities]="filteredOpportunities()"
      [userType]="getUserTypeLabel()"
      [canApply]="canApplyToOpportunity()"
      (apply)="applyToOpportunity($event)"
      (viewDetails)="viewOpportunityDetails($event)"
      (manage)="manageApplications($event)"
      (signInToApply)="redirectToLogin()"
    >
    </app-opportunities-grid>
  </div>
</div>
}

<!-- Smart Suggestions Modal (All Views) -->
<app-smart-suggestions-modal
  (apply)="handleSuggestionApply($event)"
  (viewDetails)="handleSuggestionViewDetails($event)"
  (signIn)="handleSuggestionSignIn()"
  (viewAll)="handleViewAllOpportunities()"
>
</app-smart-suggestions-modal>
