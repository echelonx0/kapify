 <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
      
      <!-- Header -->
      <div class="px-6 py-4 bg-gradient-to-r from-purple-50 to-indigo-50 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-xl flex items-center justify-center">
              <lucide-icon [img]="SparklesIcon" [size]="20" class="text-white" />
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900">AI Document Analysis</h3>
              <p class="text-sm text-gray-600">Upload and analyze business proposals with market intelligence</p>
            </div>
          </div>
          @if (analysisResult()) {
            <ui-button variant="outline" size="sm" (click)="resetAnalysis()">
              <lucide-icon [img]="UploadIcon" [size]="16" class="mr-2" />
              New Analysis
            </ui-button>
          }
        </div>
      </div>

      <!-- Upload Section -->
      @if (!analysisResult() && !isProcessing()) {
        <div class="p-8">
          <!-- Drag & Drop Area -->
          <div 
            class="relative border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-400 transition-colors cursor-pointer"
            [class.border-purple-400]="isDragOver()"
            [class.bg-purple-50]="isDragOver()"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
            (click)="fileInput.click()">
            
            <input 
              #fileInput 
              type="file" 
              accept=".pdf"
              class="hidden" 
              (change)="onFileSelected($event)">
            
            <div class="space-y-4">
              <div class="w-16 h-16 bg-gray-100 rounded-2xl mx-auto flex items-center justify-center">
                <lucide-icon [img]="FileTextIcon" [size]="32" class="text-gray-400" />
              </div>
              
              <div>
                <h4 class="text-lg font-semibold text-gray-900 mb-2">Upload Business Proposal</h4>
                <p class="text-gray-600 mb-4">
                  Drop your PDF here or click to browse. Get instant AI analysis with market intelligence.
                </p>
                <div class="text-sm text-gray-500">
                  Supported format: PDF (max 10MB)
                </div>
              </div>
            </div>
          </div>

          <!-- Analysis Features Grid -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mt-8">
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                <lucide-icon [img]="TargetIcon" [size]="16" class="text-blue-600" />
              </div>
              <div class="text-sm font-medium text-gray-900">Investment Score</div>
              <div class="text-xs text-gray-600">AI-powered assessment</div>
            </div>
            
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                <lucide-icon [img]="GlobeIcon" [size]="16" class="text-green-600" />
              </div>
              <div class="text-sm font-medium text-gray-900">Market Intelligence</div>
              <div class="text-xs text-gray-600">Real-time research</div>
            </div>
            
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                <lucide-icon [img]="TrendingUpIcon" [size]="16" class="text-purple-600" />
              </div>
              <div class="text-sm font-medium text-gray-900">Competitive Analysis</div>
              <div class="text-xs text-gray-600">Position assessment</div>
            </div>
            
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                <lucide-icon [img]="AlertTriangleIcon" [size]="16" class="text-orange-600" />
              </div>
              <div class="text-sm font-medium text-gray-900">Risk Assessment</div>
              <div class="text-xs text-gray-600">Comprehensive flags</div>
            </div>
          </div>
        </div>
      }

      <!-- Processing Status -->
      @if (isProcessing()) {
        <div class="p-8">
          <div class="text-center mb-8">
            <div class="w-16 h-16 bg-purple-100 rounded-2xl mx-auto mb-4 flex items-center justify-center">
              <lucide-icon [img]="Loader2Icon" [size]="32" class="text-purple-600 animate-spin" />
            </div>
            <h4 class="text-lg font-semibold text-gray-900 mb-2">Analyzing Document</h4>
            <p class="text-gray-600">AI is processing your document and gathering market intelligence...</p>
          </div>

          <!-- Processing Timeline -->
          <div class="space-y-4 max-w-md mx-auto">
            @for (status of processingStatuses(); track status.stage) {
              <div class="flex items-center space-x-3">
                <div class="flex-shrink-0">
                  @if (status.completed) {
                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                      <lucide-icon [img]="CheckCircleIcon" [size]="14" class="text-white" />
                    </div>
                  } @else if (status.active) {
                    <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center">
                      <lucide-icon [img]="Loader2Icon" [size]="14" class="text-white animate-spin" />
                    </div>
                  } @else {
                    <div class="w-6 h-6 bg-gray-300 rounded-full"></div>
                  }
                </div>
                <div class="flex-1">
                  <div class="text-sm font-medium" 
                       [class.text-gray-900]="status.completed || status.active"
                       [class.text-gray-500]="!status.completed && !status.active">
                    {{ status.label }}
                  </div>
                  @if (status.active && status.details) {
                    <div class="text-xs text-gray-600">{{ status.details }}</div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Error State -->
      @if (hasError()) {
        <div class="p-8 text-center">
          <div class="w-16 h-16 bg-red-100 rounded-2xl mx-auto mb-4 flex items-center justify-center">
            <lucide-icon [img]="XCircleIcon" [size]="32" class="text-red-600" />
          </div>
          <h4 class="text-lg font-semibold text-gray-900 mb-2">Analysis Failed</h4>
          <p class="text-gray-600 mb-6">{{ errorMessage() }}</p>
          <div class="space-x-4">
            <ui-button variant="outline" (click)="resetAnalysis()">Try Again</ui-button>
          </div>
        </div>
      }

      <!-- Analysis Results -->
      @if (analysisResult() && !isProcessing()) {
        <div class="divide-y divide-gray-100">
          
          <!-- Executive Summary -->
          <div class="p-6">
            <div class="flex items-center justify-between mb-6">
              <h4 class="text-lg font-semibold text-gray-900">Executive Summary</h4>
              <div class="flex items-center space-x-2">
                <div class="text-sm text-gray-500">Confidence:</div>
                <div class="text-sm font-semibold text-gray-900">{{ analysisResult()!.confidence }}%</div>
              </div>
            </div>

            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
              <!-- Investment Score -->
              <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-100">
                <div class="text-3xl font-bold text-blue-600 mb-1">{{ analysisResult()!.matchScore }}%</div>
                <div class="text-sm font-medium text-blue-900">Investment Score</div>
              </div>

              <!-- Success Probability -->
              <div class="text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-100">
                <div class="text-3xl font-bold text-green-600 mb-1">{{ analysisResult()!.successProbability }}%</div>
                <div class="text-sm font-medium text-green-900">Success Probability</div>
              </div>

              <!-- Market Timing -->
              <div class="text-center p-4 rounded-lg border"
                   [class]="getTimingClasses(analysisResult()!.marketTimingInsight)">
                <div class="text-sm font-bold uppercase tracking-wide mb-1">{{ analysisResult()!.marketTimingInsight }}</div>
                <div class="text-sm font-medium">Market Timing</div>
              </div>

              <!-- Competitive Position -->
              <div class="text-center p-4 rounded-lg border"
                   [class]="getPositionClasses(analysisResult()!.competitivePositioning)">
                <div class="text-sm font-bold uppercase tracking-wide mb-1">{{ analysisResult()!.competitivePositioning }}</div>
                <div class="text-sm font-medium">Competitive Position</div>
              </div>
            </div>

            <!-- Market Intelligence Summary -->
            @if (analysisResult()!.marketIntelligence) {
              <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-2 mb-3">
                  <lucide-icon [img]="GlobeIcon" [size]="16" class="text-purple-600" />
                  <div class="font-semibold text-purple-900">Live Market Intelligence</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                  <div>
                    <div class="font-medium text-purple-900">Funding Activity</div>
                    <div class="text-purple-700">{{ analysisResult()!.marketIntelligence.fundingTrends.dealCount }} deals last quarter</div>
                  </div>
                  <div>
                    <div class="font-medium text-purple-900">Average Round</div>
                    <div class="text-purple-700">{{ formatCurrency(analysisResult()!.marketIntelligence.fundingTrends.averageRoundSize) }}</div>
                  </div>
                  <div>
                    <div class="font-medium text-purple-900">Valuation Trend</div>
                    <div class="text-purple-700 capitalize">{{ analysisResult()!.marketIntelligence.fundingTrends.valuationTrend }}</div>
                  </div>
                </div>
              </div>
            }
          </div>

          <!-- Hidden Gems & Contrarian Signals -->
          @if (analysisResult()!.hiddenGemIndicators.length || analysisResult()!.contrarianSignals.length) {
            <div class="p-6">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Investment Intelligence</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                @if (analysisResult()!.hiddenGemIndicators.length) {
                  <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <div class="flex items-center space-x-2 mb-3">
                      <lucide-icon [img]="EyeIcon" [size]="16" class="text-emerald-600" />
                      <div class="font-semibold text-emerald-900">Hidden Gem Indicators</div>
                    </div>
                    <div class="space-y-2">
                      @for (indicator of analysisResult()!.hiddenGemIndicators; track indicator) {
                        <div class="flex items-start space-x-2 text-sm text-emerald-800">
                          <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                          <span>{{ indicator }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }

                @if (analysisResult()!.contrarianSignals.length) {
                  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center space-x-2 mb-3">
                      <lucide-icon [img]="TrendingUpIcon" [size]="16" class="text-blue-600" />
                      <div class="font-semibold text-blue-900">Contrarian Signals</div>
                    </div>
                    <div class="space-y-2">
                      @for (signal of analysisResult()!.contrarianSignals; track signal) {
                        <div class="flex items-start space-x-2 text-sm text-blue-800">
                          <div class="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
                          <span>{{ signal }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Strengths & Improvement Areas -->
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              
              <!-- Strengths -->
              <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg">
                <div class="flex items-center space-x-2 mb-3">
                  <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-600" />
                  <div class="font-semibold text-green-900">Key Strengths</div>
                </div>
                <div class="space-y-2">
                  @for (strength of analysisResult()!.strengths; track strength) {
                    <div class="flex items-start space-x-2 text-sm text-green-800">
                      <div class="w-1.5 h-1.5 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                      <span>{{ strength }}</span>
                    </div>
                  }
                </div>
              </div>

              <!-- Improvement Areas -->
              <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-lg">
                <div class="flex items-center space-x-2 mb-3">
                  <lucide-icon [img]="TrendingUpIcon" [size]="16" class="text-orange-600" />
                  <div class="font-semibold text-orange-900">Improvement Areas</div>
                </div>
                <div class="space-y-2">
                  @for (area of analysisResult()!.improvementAreas; track area) {
                    <div class="flex items-start space-x-2 text-sm text-orange-800">
                      <div class="w-1.5 h-1.5 bg-orange-500 rounded-full mt-2 flex-shrink-0"></div>
                      <span>{{ area }}</span>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Risk Factors -->
          @if (analysisResult()!.riskFactors.length) {
            <div class="p-6">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Risk Assessment</h4>
              <div class="space-y-3">
                @for (risk of analysisResult()!.riskFactors; track risk.factor) {
                  <div class="flex items-start space-x-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex-shrink-0 mt-0.5">
                      <div [class]="getRiskSeverityBadge(risk.severity)">
                        {{ risk.severity.toUpperCase() }}
                      </div>
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold text-gray-900 mb-1">{{ risk.factor }}</div>
                      <div class="text-sm text-gray-700">{{ risk.impact }}</div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Market Intelligence Details -->
          @if (analysisResult()!.marketIntelligence) {
            <div class="p-6">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Market Intelligence</h4>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Market Trends -->
                @if (analysisResult()!.marketIntelligence.trends.length) {
                  <div>
                    <h5 class="font-semibold text-gray-900 mb-3">Current Trends</h5>
                    <div class="space-y-2">
                      @for (trend of analysisResult()!.marketIntelligence.trends; track trend) {
                        <div class="flex items-start space-x-2 text-sm">
                          <lucide-icon [img]="TrendingUpIcon" [size]="14" class="text-blue-500 mt-0.5 flex-shrink-0" />
                          <span class="text-gray-700">{{ trend }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }

                <!-- Competitor Activity -->
                @if (analysisResult()!.marketIntelligence.competitorActivity.length) {
                  <div>
                    <h5 class="font-semibold text-gray-900 mb-3">Competitor Activity</h5>
                    <div class="space-y-2">
                      @for (activity of analysisResult()!.marketIntelligence.competitorActivity; track activity) {
                        <div class="flex items-start space-x-2 text-sm">
                          <lucide-icon [img]="BuildingIcon" [size]="14" class="text-purple-500 mt-0.5 flex-shrink-0" />
                          <span class="text-gray-700">{{ activity }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }

                <!-- Timing Insights -->
                @if (analysisResult()!.marketIntelligence.timingInsights.length) {
                  <div>
                    <h5 class="font-semibold text-gray-900 mb-3">Market Timing</h5>
                    <div class="space-y-2">
                      @for (insight of analysisResult()!.marketIntelligence.timingInsights; track insight) {
                        <div class="flex items-start space-x-2 text-sm">
                          <lucide-icon [img]="ClockIcon" [size]="14" class="text-green-500 mt-0.5 flex-shrink-0" />
                          <span class="text-gray-700">{{ insight }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }

                <!-- Investment Opportunities -->
                @if (analysisResult()!.marketIntelligence.opportunities.length) {
                  <div>
                    <h5 class="font-semibold text-gray-900 mb-3">Investment Opportunities</h5>
                    <div class="space-y-3">
                      @for (opportunity of analysisResult()!.marketIntelligence.opportunities; track opportunity.opportunity) {
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                          <div class="font-medium text-emerald-900 mb-1">{{ opportunity.opportunity }}</div>
                          <div class="text-sm text-emerald-700 mb-2">{{ opportunity.rationale }}</div>
                          <div class="text-xs text-emerald-600">Timeframe: {{ opportunity.timeframe }}</div>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Recommendations -->
          <div class="p-6">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Strategic Recommendations</h4>
            <div class="space-y-3">
              @for (recommendation of analysisResult()!.recommendations; track recommendation) {
                <div class="flex items-start space-x-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                  <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                    <span class="text-xs font-bold text-blue-600">{{ $index + 1 }}</span>
                  </div>
                  <span class="text-blue-800 font-medium">{{ recommendation }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Sources & Research -->
          @if (analysisResult()!.sources.length || analysisResult()!.searchQueries.length) {
            <div class="p-6 bg-gray-50">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Research Sources</h4>
              
              @if (analysisResult()!.searchQueries.length) {
                <div class="mb-4">
                  <h5 class="font-medium text-gray-700 mb-2">Search Queries Used</h5>
                  <div class="flex flex-wrap gap-2">
                    @for (query of analysisResult()!.searchQueries; track query) {
                      <span class="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded-md">{{ query }}</span>
                    }
                  </div>
                </div>
              }

              @if (analysisResult()!.sources.length) {
                <div>
                  <h5 class="font-medium text-gray-700 mb-2">Information Sources</h5>
                  <div class="space-y-2">
                    @for (source of analysisResult()!.sources.slice(0, 5); track source.title) {
                      <div class="flex items-center space-x-2 text-sm">
                        <lucide-icon [img]="GlobeIcon" [size]="12" class="text-gray-400 flex-shrink-0" />
                        <span class="text-gray-700 truncate">{{ source.title }}</span>
                        @if (source.url) {
                          <a [href]="source.url" target="_blank" class="text-blue-600 hover:text-blue-800 flex-shrink-0">
                            <lucide-icon [img]="EyeIcon" [size]="12" />
                          </a>
                        }
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }

          <!-- Action Footer -->
          <div class="px-6 py-4 bg-gray-50 flex items-center justify-between">
            <div class="text-sm text-gray-600">
              Generated {{ getTimeAgo(analysisResult()!.generatedAt) }} with {{ analysisResult()!.confidence }}% confidence
            </div>
            
            <div class="flex space-x-3">
              <ui-button variant="outline" (click)="downloadReport()">
                <lucide-icon [img]="DownloadIcon" [size]="16" class="mr-2" />
                Download Report
              </ui-button>
              <ui-button variant="primary" (click)="shareAnalysis()">
                Share Analysis
              </ui-button>
            </div>
          </div>
        </div>
      }
    </div>