<div class="min-h-screen flex flex-col lg:flex-row bg-slate-50">
  <!-- Left Panel - Form (Mobile Full Width, Desktop 60%) -->
  <div
    class="w-full lg:w-3/5 flex items-center justify-center px-4 py-8 lg:px-8 lg:py-6 lg:bg-white"
  >
    <div class="w-full max-w-md">
      <!-- Logo & Header -->
      <div class="mb-8 lg:mb-12">
        <div class="flex items-center gap-3 mb-4">
          <div
            class="w-10 h-10 bg-teal-500 rounded-xl flex items-center justify-center flex-shrink-0"
          >
            <lucide-icon name="lock" [size]="20" class="text-white" />
          </div>
          <h1 class="text-2xl lg:text-3xl font-bold text-slate-900">
            Reset Password
          </h1>
        </div>
        <p class="text-slate-600 text-sm">
          @if (!showSuccess()) { Create a new secure password for your account }
          @else { Password reset successful }
        </p>
      </div>

      <!-- Success Animation -->
      @if (showSuccess()) {
      <div class="mb-8 flex flex-col items-center space-y-4">
        <!-- Animated Checkmark -->
        <div class="relative w-16 h-16">
          <svg
            class="w-16 h-16 text-green-600 animate-pulse"
            viewBox="0 0 24 24"
            fill="none"
          >
            <circle
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="2"
            />
            <path
              d="M8 12l2 2 4-4"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div class="text-center">
          <p class="text-slate-900 font-semibold mb-2">
            Password Reset Complete
          </p>
          <p class="text-slate-600 text-sm">
            Your password has been successfully updated. You can now log in with
            your new password.
          </p>
        </div>
        <button
          (click)="navigateToLogin()"
          class="w-full bg-teal-500 hover:bg-teal-600 active:bg-teal-700 text-white font-medium rounded-xl px-6 py-2.5 text-sm transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2"
        >
          Back to Login
        </button>
      </div>
      } @else {
      <!-- Reset Form -->
      <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="space-y-5">
        <!-- Password Field -->
        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            New Password
          </label>
          <div class="relative">
            <input
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Create a strong password"
              (input)="updatePasswordStrength()"
              class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
              [class.border-red-50]="isPasswordFieldInvalid()"
              [class.bg-red-30]="isPasswordFieldInvalid()"
            />
            <button
              type="button"
              tabindex="-1"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors duration-200 flex-shrink-0 p-1"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="
                showPassword() ? 'Hide password' : 'Show password'
              "
            >
              <lucide-icon
                [name]="showPassword() ? 'eye-off' : 'eye'"
                [size]="20"
              />
            </button>
          </div>

          <!-- Password Strength Meter -->
          @if (resetForm.get('password')?.value) {
          <div class="mt-3 space-y-2">
            <!-- Strength Bar -->
            <div class="h-1.5 bg-slate-100 rounded-full overflow-hidden">
              <div
                class="h-full bg-gradient-to-r transition-all duration-700 ease-out rounded-full"
                [class]="getStrengthBarColor()"
                [style.width.%]="passwordStrength()"
              ></div>
            </div>

            <!-- Strength Text -->
            <p class="text-xs font-medium" [class]="getStrengthTextColor()">
              {{ getStrengthLabel() }}
            </p>

            <!-- Feedback Items -->
            @if (passwordFeedback().feedback.length > 0) {
            <ul class="text-xs text-slate-600 space-y-1">
              @for (item of passwordFeedback().feedback; track item) {
              <li class="flex items-center gap-2">
                <lucide-icon
                  name="alert-circle"
                  [size]="14"
                  class="text-amber-600 flex-shrink-0"
                />
                <span>{{ item }}</span>
              </li>
              }
            </ul>
            }
          </div>
          } @if (isPasswordFieldInvalid()) {
          <p class="mt-1.5 text-sm text-red-700">
            Password must be at least 8 characters long
          </p>
          }
        </div>

        <!-- Confirm Password Field -->
        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Confirm Password
          </label>
          <div class="relative">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Confirm your
            password"
              class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
              [class.border-red-50]="isConfirmPasswordFieldInvalid()"
              [class.bg-red-30]="isConfirmPasswordFieldInvalid()"
            />
            <button
              type="button"
              tabindex="-1"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors duration-200 flex-shrink-0 p-1"
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="
                showConfirmPassword() ? 'Hide password' : 'Show password'
              "
            >
              <lucide-icon
                [name]="showConfirmPassword() ? 'eye-off' : 'eye'"
                [size]="20"
              />
            </button>
          </div>

          @if (isConfirmPasswordFieldInvalid()) {
          <p class="text-sm text-red-700 mt-1.5">Passwords do not match</p>
          }
        </div>

        <!-- Error Message -->
        @if (error()) {
        <div
          class="bg-red-50 border border-red-200/50 text-red-700 px-4 py-3 rounded-xl text-sm flex items-start gap-3"
        >
          <lucide-icon
            name="alert-circle"
            [size]="18"
            class="flex-shrink-0 mt-0.5"
          />
          <span>{{ error() }}</span>
        </div>
        }

        <!-- Submit Button -->
        <button
          type="submit"
          [disabled]="isSubmitting() || !resetForm.valid"
          class="w-full bg-teal-500 hover:bg-teal-600 active:bg-teal-700 disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed text-white font-medium py-2.5 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 flex items-center justify-center"
        >
          @if (isSubmitting()) {
          <div
            class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"
          ></div>
          <span>Resetting...</span>
          } @else {
          <span>Reset Password</span>
          }
        </button>
      </form>
      }

      <!-- Footer Links -->
      <div class="mt-8 space-y-4">
        <!-- Back to Login -->
        @if (!showSuccess()) {
        <div class="text-center text-sm">
          <p class="text-slate-600">
            Know your password?
            <a
              routerLink="/login"
              class="text-teal-600 font-medium hover:text-teal-700 transition-colors duration-200"
            >
              Back to Login
            </a>
          </p>
        </div>
        }

        <!-- Help Text -->
        <div class="text-xs text-slate-600 leading-relaxed text-center">
          Need additional help?
          <a
            href="mailto:support@kapify.co"
            class="text-slate-900 font-semibold hover:underline"
          >
            Contact Support
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Panel - Image (Hidden Mobile, Show Desktop) -->
  <div class="hidden lg:flex lg:w-2/5 relative overflow-hidden bg-white">
    <img
      src="/images/pwd.png"
      alt="Password reset illustration"
      class="absolute inset-0 w-full h-full object-cover"
    />
    <div
      class="absolute inset-0 bg-gradient-to-br from-teal-500/10 to-teal-400/5"
    ></div>
  </div>
</div>
