<!-- Modal Backdrop -->
<div
  class="fixed inset-0 bg-black/25 backdrop-blur-sm z-50 flex items-center justify-center p-4"
  (click)="cancel()"
>
  <!-- Modal Container -->
  <div
    class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div
      class="px-6 py-5 border-b border-slate-200 flex items-center justify-between"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center"
        >
          <lucide-icon [img]="MailIcon" [size]="20" class="text-teal-600" />
        </div>
        <div>
          <h2 class="text-lg font-bold text-slate-900">Invite Team Member</h2>
          <p class="text-xs text-slate-600">
            Send an invitation to join your organization
          </p>
        </div>
      </div>
      <button
        (click)="cancel()"
        class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-2 rounded-lg transition-colors duration-200"
      >
        <lucide-icon [img]="XIcon" [size]="20" />
      </button>
    </div>

    <!-- Body -->
    <div class="px-6 py-6 overflow-y-auto max-h-[calc(90vh-140px)]">
      <!-- Form Error -->
      @if (formError()) {
      <div
        class="mb-6 bg-red-50 border border-red-200/50 rounded-xl p-4 flex items-start gap-3"
      >
        <lucide-icon
          [img]="XIcon"
          [size]="20"
          class="text-red-600 flex-shrink-0 mt-0.5"
        />
        <div class="flex-1">
          <p class="text-sm font-semibold text-red-900">Error</p>
          <p class="text-sm text-red-700">{{ formError() }}</p>
        </div>
      </div>
      }

      <!-- Email Field -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-slate-900 mb-2">
          Email Address <span class="text-teal-500">*</span>
        </label>
        <div class="relative">
          <input
            type="email"
            [(ngModel)]="email"
            (blur)="onEmailBlur()"
            [class]="
              emailError()
                ? 'w-full pl-11 pr-4 py-2.5 border border-red-300 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200'
                : 'w-full pl-11 pr-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200'
            "
            placeholder="colleague@company.com"
            [disabled]="isInviting()"
          />
        </div>
        @if (emailError()) {
        <p class="mt-2 text-sm text-red-700">{{ emailError() }}</p>
        }
        <p class="mt-2 text-xs text-slate-600">
          An invitation email will be sent to this address
        </p>
      </div>

      <!-- Optional Name Fields -->
      <div class="mb-6 grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            First Name
            <span class="text-slate-400 font-normal">(Optional)</span>
          </label>
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="firstName"
              class="w-full pl-11 pr-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
              placeholder="John"
              [disabled]="isInviting()"
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Last Name <span class="text-slate-400 font-normal">(Optional)</span>
          </label>
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="lastName"
              class="w-full pl-11 pr-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
              placeholder="Doe"
              [disabled]="isInviting()"
            />
          </div>
        </div>
      </div>

      <!-- Role Selection -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-slate-900 mb-3">
          Role <span class="text-teal-500">*</span>
        </label>

        <div class="space-y-3">
          @for (role of roleOptions; track trackByRoleValue($index, role)) {
          <button
            type="button"
            (click)="selectRole(role.value)"
            [disabled]="isInviting()"
            [class]="
              'w-full text-left p-4 border rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed ' +
              getRoleColorClasses(role.color)
            "
          >
            <div class="flex items-start gap-3">
              <div
                [class]="
                  'w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-' +
                  role.color +
                  '-100'
                "
              >
                <lucide-icon
                  [img]="role.icon"
                  [size]="20"
                  [class]="getRoleIconColor(role.color)"
                />
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <p class="text-sm font-semibold text-slate-900">
                    {{ role.label }}
                  </p>
                  @if (selectedRole() === role.value) {
                  <div
                    [class]="'w-2 h-2 rounded-full bg-' + role.color + '-500'"
                  ></div>
                  }
                </div>
                <p class="text-xs text-slate-600 leading-relaxed">
                  {{ role.description }}
                </p>
              </div>
            </div>
          </button>
          }
        </div>
      </div>

      <!-- Info Box -->
      <!-- <div class="bg-blue-50 border border-blue-200/50 rounded-xl p-4">
        <p class="text-sm text-blue-900">
          <span class="font-semibold">Note:</span> The invited member will
          receive an email with a secure link to accept the invitation. The
          invitation will expire in 7 days.
        </p>
      </div> -->
    </div>

    <!-- Footer -->
    <div
      class="px-6 py-4 border-t border-slate-200 bg-slate-50/50 flex items-center justify-end gap-3"
    >
      <button
        (click)="cancel()"
        [disabled]="isInviting()"
        class="bg-slate-100 text-slate-700 font-medium rounded-xl px-6 py-2.5 text-sm hover:bg-slate-200 active:bg-slate-300 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Cancel
      </button>
      <button
        (click)="sendInvitation()"
        [disabled]="isInviting() || !email().trim()"
        class="bg-teal-500 text-white font-medium rounded-xl px-6 py-2.5 text-sm hover:bg-teal-600 active:bg-teal-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
      >
        @if (isInviting()) {
        <div
          class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"
        ></div>
        <span>Sending...</span>
        } @else {
        <lucide-icon [img]="MailIcon" [size]="18" />
        <span>Send Invitation</span>
        }
      </button>
    </div>
  </div>
</div>
