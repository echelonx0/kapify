    <div class="min-h-screen bg-neutral-50">
      <!-- Header -->
      <div class="bg-white border-b border-neutral-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between py-6">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-neutral-800 rounded-lg flex items-center justify-center mr-3">
                <lucide-icon [img]="SettingsIcon" [size]="20" class="text-white" />
              </div>
              <h1 class="text-2xl font-bold text-neutral-900">Settings</h1>
            </div>
            
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input
                  type="text"
                  placeholder="Search a user, settings..."
                  class="w-64 pl-3 pr-3 py-2 border border-neutral-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Settings Navigation -->
        <div class="flex space-x-1 mb-8 bg-white rounded-lg p-1 border border-neutral-200 w-fit">
          @for (tab of tabs; track tab.id) {
            <button
              (click)="setActiveTab(tab.id)"
              [class]="getTabClasses(tab.id)"
              [disabled]="!tab.enabled"
            >
              {{ tab.label }}
              @if (!tab.enabled) {
                <ui-badge variant="info" size="sm" class="ml-2">Pro</ui-badge>
              }
            </button>
          }
        </div>

        <!-- Settings Content -->
        @if (isLoading()) {
          <div class="bg-white rounded-lg border border-neutral-200 p-8 text-center">
            <div class="animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-neutral-600">Loading settings...</p>
          </div>
        } @else if (error()) {
          <div class="bg-white rounded-lg border border-neutral-200 p-8 text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <lucide-icon [img]="XIcon" [size]="24" class="text-red-600" />
            </div>
            <h3 class="text-lg font-medium text-neutral-900 mb-2">Error Loading Settings</h3>
            <p class="text-neutral-600 mb-4">{{ error() }}</p>
            <button 
              (click)="loadProfile()"
              class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
            >
              Try Again
            </button>
          </div>
        } @else {
          @switch (activeTab()) {
            @case ('personal') {
              <div class="bg-white rounded-lg border border-neutral-200">
                <div class="px-6 py-4 border-b border-neutral-200">
                  <h3 class="text-lg font-medium text-neutral-900">Personal</h3>
                  <p class="text-sm text-neutral-600">Update your personal details and profile picture</p>
                </div>
                
                <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="p-6 space-y-6">
                  <!-- Profile Picture Section -->
                  <div class="flex items-start space-x-6">
                    <div class="flex-shrink-0">
                      <ui-avatar
                        [src]="currentUser()?.profilePicture"
                        [name]="userDisplayName()"
                        size="xl"
                        class="border-4 border-white shadow-lg"
                      />
                      <button
                        type="button"
                        (click)="triggerFileUpload()"
                        class="mt-3 w-full px-3 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-md hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-primary-500"
                      >
                        <lucide-icon [img]="CameraIcon" [size]="16" class="mr-2 inline" />
                        Change Photo
                      </button>
                      <input
                        #fileInput
                        type="file"
                        accept="image/*"
                        (change)="onFileSelected($event)"
                        class="hidden"
                      />
                    </div>
                    
                    <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">First Name *</label>
                        <input
                          type="text"
                          formControlName="firstName"
                          class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        />
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Last Name *</label>
                        <input
                          type="text"
                          formControlName="lastName"
                          class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        />
                      </div>
                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Email Address *</label>
                        <input
                          type="email"
                          formControlName="email"
                          class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        />
                      </div>
                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Phone Number</label>
                        <input
                          type="tel"
                          formControlName="phone"
                          class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- Organization Info -->
                  <div class="border-t border-neutral-200 pt-6">
                    <h4 class="text-lg font-medium text-neutral-900 mb-4">Organization Details</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-neutral-700 mb-2">
                          {{ currentUser()?.userType === 'sme' ? 'Company Name' : 'Organization Name' }} *
                        </label>
                        <input
                          type="text"
                          formControlName="organizationName"
                          class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        />
                      </div>
                      
                      @if (currentUser()?.userType === 'sme') {
                        <div>
                          <label class="block text-sm font-medium text-neutral-700 mb-2">Registration Number *</label>
                          <input
                            type="text"
                            formControlName="registrationNumber"
                            class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                          />
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-neutral-700 mb-2">VAT Number</label>
                          <input
                            type="text"
                            formControlName="vatNumber"
                            class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                          />
                        </div>
                        <div class="md:col-span-2">
                          <label class="block text-sm font-medium text-neutral-700 mb-2">Industry *</label>
                          <ui-dropdown
                            [options]="industryOptions"
                            [selectedValue]="organizationForm.get('industry')?.value || ''"
                            placeholder="Select Industry"
                            (selectionChange)="organizationForm.get('industry')?.setValue($event)"
                          />
                        </div>
                      }
                    </div>
                  </div>

                  <div class="flex justify-end pt-6 border-t border-neutral-200">
                    <button
                      type="submit"
                      [disabled]="profileForm.invalid || isSaving()"
                      class="px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                    >
                      @if (isSaving()) {
                        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
                        Saving...
                      } @else {
                        <lucide-icon [img]="SaveIcon" [size]="16" class="mr-2" />
                        Save Changes
                      }
                    </button>
                  </div>
                </form>
              </div>
            }

            @case ('members') {
              <div class="space-y-6">
                <!-- Members Section -->
                <ui-table
                  title="Members"
                  subtitle="Invite your team members to work faster and collaborate easily together. Manage their permissions to better structure projects."
                  [columns]="memberColumns"
                  [data]="teamMembersDisplay()"
                  [headerActions]="memberHeaderActions"
                  [actions]="memberActions"
                  emptyMessage="No team members yet."
                >
                </ui-table>

                <!-- Guest Accounts Section -->
                <ui-table
                  title="Guest accounts"
                  subtitle="Guest accounts allow your external partners to collaborate and communicate with you, right here on Nook."
                  [columns]="guestColumns"
                  [data]="guestUsersDisplay()"
                  [headerActions]="guestHeaderActions"
                  [actions]="guestActions"
                  emptyMessage="No guest accounts yet."
                >
                </ui-table>

                <!-- Pending Invites Section -->
                <ui-table
                  title="Pending Invites"
                  subtitle="Guest accounts allow your external partners to collaborate and communicate with you, right here on Nook."
                  [columns]="inviteColumns"
                  [data]="pendingInvitesDisplay()"
                  [headerActions]="[]"
                  [actions]="inviteActions"
                  emptyMessage="No pending invites."
                >
                </ui-table>
              </div>
            }

            @case ('billing') {
              <div class="space-y-6">
                <!-- Current Plan -->
                <div class="bg-white rounded-lg border border-neutral-200">
                  <div class="px-6 py-4 border-b border-neutral-200">
                    <h3 class="text-lg font-medium text-neutral-900">Current Plan</h3>
                    <p class="text-sm text-neutral-600">Manage your subscription and billing information</p>
                  </div>
                  
                  <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                      <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
                          <lucide-icon [img]="CreditCardIcon" [size]="24" class="text-primary-600" />
                        </div>
                        <div>
                          <h4 class="text-xl font-semibold text-neutral-900 capitalize">{{ currentPlan() }} Plan</h4>
                          <div class="flex items-center text-sm text-neutral-600">
                            @if (monthlyAmount() > 0) {
                              <span>R{{ monthlyAmount() }}/month</span>
                              <span class="mx-2">â€¢</span>
                              <span>Billed monthly</span>
                            } @else {
                              <span>Free plan</span>
                            }
                          </div>
                        </div>
                      </div>
                      
                      @if (currentPlan() !== 'enterprise') {
                        <button 
                          (click)="upgradePlan()"
                          class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 flex items-center"
                        >
                          Upgrade Plan
                          <lucide-icon [img]="ExternalLinkIcon" [size]="16" class="ml-2" />
                        </button>
                      }
                    </div>

                    <!-- Plan Features -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                      @if (currentPlan() === 'basic') {
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Basic profile management
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Up to 3 team members
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Basic support
                        </div>
                      } @else if (currentPlan() === 'premium') {
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Advanced profile features
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Up to 25 team members
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Priority support
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Advanced analytics
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          API access
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Custom integrations
                        </div>
                      } @else {
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Everything in Premium
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Unlimited team members
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          24/7 phone support
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Custom reporting
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          Dedicated account manager
                        </div>
                        <div class="flex items-center text-sm text-neutral-600">
                          <lucide-icon [img]="CheckCircleIcon" [size]="16" class="text-green-500 mr-2" />
                          SLA guarantee
                        </div>
                      }
                    </div>

                    @if (monthlyAmount() > 0) {
                      <!-- Next Billing -->
                      <div class="flex items-center justify-between p-4 bg-neutral-50 rounded-lg">
                        <div class="flex items-center">
                          <lucide-icon [img]="CalendarIcon" [size]="20" class="text-neutral-500 mr-3" />
                          <div>
                            <p class="text-sm font-medium text-neutral-900">Next billing date</p>
                            <p class="text-sm text-neutral-600">{{ formatDate(nextBillingDate()) }}</p>
                          </div>
                        </div>
                        <div class="text-right">
                          <p class="text-sm font-medium text-neutral-900">R{{ monthlyAmount() }}</p>
                          <p class="text-sm text-neutral-600">Monthly</p>
                        </div>
                      </div>
                    }
                  </div>
                </div>

                <!-- Payment Method -->
                @if (billingDetails()) {
                  <div class="bg-white rounded-lg border border-neutral-200">
                    <div class="px-6 py-4 border-b border-neutral-200">
                      <h3 class="text-lg font-medium text-neutral-900">Payment Method</h3>
                      <p class="text-sm text-neutral-600">Manage your payment information</p>
                    </div>
                    
                    <div class="p-6">
                      @if (billingDetails()?.paymentMethod) {
                        <div class="flex items-center justify-between p-4 border border-neutral-200 rounded-lg">
                          <div class="flex items-center">
                            <div class="w-10 h-10 bg-neutral-100 rounded-lg flex items-center justify-center mr-4">
                              <lucide-icon [img]="CreditCardIcon" [size]="20" class="text-neutral-600" />
                            </div>
                            <div>
                              <p class="text-sm font-medium text-neutral-900 capitalize">
                                {{ billingDetails()?.paymentMethod?.brand || 'Credit Card' }} ending in {{ billingDetails()?.paymentMethod?.last4 }}
                              </p>
                              <p class="text-sm text-neutral-600">
                                Expires {{ billingDetails()?.paymentMethod?.expiryMonth }}/{{ billingDetails()?.paymentMethod?.expiryYear }}
                              </p>
                            </div>
                          </div>
                          <div class="flex items-center space-x-3">
                            @if (billingDetails()?.paymentMethod?.isDefault) {
                              <ui-badge variant="success" size="sm">Default</ui-badge>
                            }
                            <button class="text-sm text-primary-600 hover:text-primary-700">Edit</button>
                          </div>
                        </div>
                      } @else {
                        <div class="text-center py-8">
                          <lucide-icon [img]="CreditCardIcon" [size]="48" class="text-neutral-400 mx-auto mb-4" />
                          <h4 class="text-lg font-medium text-neutral-900 mb-2">No payment method</h4>
                          <p class="text-neutral-600 mb-4">Add a payment method to upgrade your plan</p>
                          <button class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                            Add Payment Method
                          </button>
                        </div>
                      }
                    </div>
                  </div>
                }

                <!-- Billing History -->
                <div class="bg-white rounded-lg border border-neutral-200">
                  <div class="px-6 py-4 border-b border-neutral-200 flex justify-between items-center">
                    <div>
                      <h3 class="text-lg font-medium text-neutral-900">Billing History</h3>
                      <p class="text-sm text-neutral-600">Download your past invoices and receipts</p>
                    </div>
                    <button 
                      (click)="downloadAllInvoices()"
                      class="px-3 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-md hover:bg-neutral-50 flex items-center"
                    >
                      <lucide-icon [img]="DownloadIcon" [size]="16" class="mr-2" />
                      Download All
                    </button>
                  </div>
                  
                  <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-neutral-200">
                      <thead class="bg-neutral-50">
                        <tr>
                          <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Date</th>
                          <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Description</th>
                          <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Amount</th>
                          <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Status</th>
                          <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Invoice</th>
                        </tr>
                      </thead>
                      <tbody class="bg-white divide-y divide-neutral-200">
                        @for (invoice of mockInvoices(); track invoice.id) {
                          <tr class="hover:bg-neutral-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">
                              {{ formatDate(invoice.date) }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">
                              {{ invoice.description }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">
                              R{{ invoice.amount }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                              <ui-badge 
                                [variant]="invoice.status === 'paid' ? 'success' : invoice.status === 'pending' ? 'warning' : 'error'"
                                size="sm"
                              >
                                {{ invoice.status | titlecase }}
                              </ui-badge>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                              <button 
                                (click)="downloadInvoice(invoice.id)"
                                class="text-primary-600 hover:text-primary-700 flex items-center"
                              >
                                <lucide-icon [img]="DownloadIcon" [size]="16" class="mr-1" />
                                Download
                              </button>
                            </td>
                          </tr>
                        } @empty {
                          <tr>
                            <td colspan="5" class="px-6 py-8 text-center text-sm text-neutral-500">
                              No billing history available
                            </td>
                          </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- Billing Address -->
                @if (billingDetails()) {
                  <div class="bg-white rounded-lg border border-neutral-200">
                    <div class="px-6 py-4 border-b border-neutral-200">
                      <h3 class="text-lg font-medium text-neutral-900">Billing Address</h3>
                      <p class="text-sm text-neutral-600">This address will appear on your invoices</p>
                    </div>
                    
                    <div class="p-6">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                          <p class="text-sm font-medium text-neutral-900 mb-1">Company</p>
                          <p class="text-sm text-neutral-600">{{ billingDetails()?.companyName }}</p>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-neutral-900 mb-1">VAT Number</p>
                          <p class="text-sm text-neutral-600">{{ billingDetails()?.vatNumber || 'Not provided' }}</p>
                        </div>
                        <div class="md:col-span-2">
                          <p class="text-sm font-medium text-neutral-900 mb-1">Address</p>
                          <p class="text-sm text-neutral-600">
                            {{ billingDetails()?.address?.street }}<br>
                            {{ billingDetails()?.address?.suburb }}, {{ billingDetails()?.address?.city }}<br>
                            {{ billingDetails()?.address?.province }} {{ billingDetails()?.address?.postalCode }}<br>
                            {{ billingDetails()?.address?.country }}
                          </p>
                        </div>
                      </div>
                      <div class="mt-6">
                        <button class="px-4 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-md hover:bg-neutral-50">
                          Update Billing Address
                        </button>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }

            @default {
              <div class="bg-white rounded-lg border border-neutral-200 p-8 text-center">
                <h3 class="text-lg font-medium text-neutral-900 mb-2">Coming Soon</h3>
                <p class="text-neutral-600">This section is under development.</p>
              </div>
            }
          }
        }
      </div>
    </div>