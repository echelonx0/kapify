<!-- funder-dashboard.component.html - REDESIGNED: Opportunities First + Neo-Brutalist -->

<div class="min-h-screen bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6 lg:py-8">
    <!-- ============================================
         SECTION 1: DRAFT BANNER (If exists)
         ============================================ -->
    @if (draftService.canContinueDraft()) {
    <div
      class="mb-8 border-l-4 border-teal-600 bg-teal-50 rounded-xl overflow-hidden"
    >
      <div
        class="px-6 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
      >
        <!-- Left: Icon + Draft Info -->
        <div class="flex items-start sm:items-center gap-4">
          <div
            class="w-12 h-12 rounded-lg bg-teal-600 flex items-center justify-center flex-shrink-0 border-2 border-teal-700"
          >
            <lucide-icon [img]="ClockIcon" [size]="24" class="text-white" />
          </div>
          <div>
            <p class="text-base font-bold text-teal-900">
              Draft: {{ draftService.draftTitle() }}
            </p>
            <p class="text-sm text-teal-700 mt-1">
              {{ draftService.completionText() }}
            </p>
          </div>
        </div>

        <!-- Right: Action Buttons -->
        <div class="flex gap-3 sm:flex-shrink-0">
          <button
            class="flex-1 sm:flex-initial bg-teal-600 text-white font-bold rounded-xl px-6 py-2.5 text-sm hover:bg-teal-700 active:bg-teal-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border-2 border-teal-700"
            (click)="continueDraft()"
          >
            Continue
          </button>
          <button
            class="flex-1 sm:flex-initial bg-white text-teal-700 font-bold rounded-xl px-6 py-2.5 text-sm hover:bg-teal-100 active:bg-teal-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border-2 border-teal-600"
            (click)="startFreshOpportunity()"
          >
            Fresh
          </button>
        </div>
      </div>
    </div>
    }

    <!-- ============================================
         SECTION 2: OPPORTUNITIES MANAGEMENT (HERO)
         ============================================ -->
    <div class="mb-8">
      <div class="mb-6">
        <h1 class="text-3xl font-black text-slate-900 mb-2 tracking-tight">
          Your Opportunities
        </h1>
        <p class="text-base text-slate-600">
          @if (recentOpportunities().length > 0) { Manage
          {{ recentOpportunities().length }}
          {{
            recentOpportunities().length === 1 ? "opportunity" : "opportunities"
          }}
          } @else { Create your first opportunity to attract and track
          applications }
        </p>
      </div>

      <!-- Opportunities List or Empty State -->
      @if (recentOpportunities().length === 0) {
      <!-- EMPTY STATE: Bold & Energetic -->
      <div
        class="bg-white rounded-2xl border-3 border-slate-900 p-12 text-center"
      >
        <div
          class="w-20 h-20 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-6 border-2 border-slate-300"
        >
          <lucide-icon [img]="ZapIcon" [size]="40" class="text-slate-400" />
        </div>
        <h2 class="text-2xl font-black text-slate-900 mb-3 tracking-tight">
          No opportunities yet
        </h2>
        <p
          class="text-base text-slate-600 mb-8 max-w-md mx-auto leading-relaxed"
        >
          Launch your first funding opportunity and start connecting with
          promising SMEs.
        </p>

        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          @if (onboardingState()?.canCreateOpportunities) {
          <button
            class="inline-flex items-center justify-center gap-2 bg-teal-600 text-white font-bold rounded-xl px-8 py-3 text-base hover:bg-teal-700 active:bg-teal-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border-2 border-teal-700"
            (click)="createOpportunity()"
          >
            <lucide-icon [img]="PlusIcon" [size]="20" />
            <span>Create Opportunity</span>
          </button>
          <button
            class="inline-flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-bold rounded-xl px-8 py-3 text-base hover:bg-slate-200 active:bg-slate-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border-2 border-slate-300"
            (click)="importOpportunity()"
          >
            <lucide-icon [img]="FileTextIcon" [size]="20" />
            <span>Import</span>
          </button>
          } @else {
          <button
            class="inline-flex items-center justify-center gap-2 bg-slate-900 text-white font-bold rounded-xl px-8 py-3 text-base hover:bg-slate-800 active:bg-slate-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border-2 border-slate-900"
            (click)="completeOnboarding()"
          >
            <span>Complete Setup</span>
          </button>
          }
        </div>
      </div>
      } @else {
      <!-- OPPORTUNITIES GRID -->
      <div class="space-y-4">
        @for (opportunity of recentOpportunities(); track opportunity.id) {
        <!-- OPPORTUNITY CARD: Neo-Brutal Design -->
        <div
          class="bg-white rounded-xl border-3 border-slate-900 overflow-hidden hover:shadow-lg transition-shadow duration-200 group"
        >
          <!-- Card Header with Status -->
          <div
            class="px-6 py-4 border-b-3 border-slate-900 bg-slate-50 flex items-start justify-between gap-4"
          >
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-3 mb-3">
                <h3
                  class="text-lg font-black text-slate-900 truncate tracking-tight"
                >
                  {{ opportunity.title }}
                </h3>
                <span [class]="getStatusBadgeClasses(opportunity.status)">
                  {{ formatStatus(opportunity.status) }}
                </span>
              </div>
              <div class="flex flex-wrap items-center gap-4">
                <div>
                  <p
                    class="text-xs font-bold text-slate-600 uppercase tracking-widest"
                  >
                    Amount
                  </p>
                  <p class="text-xl font-black text-teal-600">
                    {{ formatCurrency(opportunity.totalAvailable) }}
                  </p>
                </div>
                <div class="h-8 w-px bg-slate-300"></div>
                <div>
                  <p
                    class="text-xs font-bold text-slate-600 uppercase tracking-widest"
                  >
                    Applications
                  </p>
                  <p class="text-xl font-black text-slate-900">
                    {{ opportunity.currentApplications || 0 }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card Actions -->
          <div class="px-6 py-4 flex flex-col sm:flex-row gap-2 bg-white">
            <!-- Primary: Manage Applications -->
            <button
              class="flex-1 flex items-center justify-center gap-2 bg-teal-600 text-white font-bold rounded-lg px-4 py-2.5 text-sm hover:bg-teal-700 active:bg-teal-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-1 border-2 border-teal-700"
              (click)="
                manageApplications(opportunity.id); $event.stopPropagation()
              "
            >
              <lucide-icon [img]="UsersIcon" [size]="16" />
              <span>Manage Apps</span>
            </button>

            <!-- Secondary Actions -->
            <button
              class="flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-semibold rounded-lg px-4 py-2.5 text-sm hover:bg-slate-200 active:bg-slate-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-1 border border-slate-300"
              (click)="
                editOpportunity(opportunity.id); $event.stopPropagation()
              "
            >
              Edit
            </button>

            <button
              class="flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-semibold rounded-lg px-4 py-2.5 text-sm hover:bg-slate-200 active:bg-slate-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-1 border border-slate-300"
              (click)="
                deleteOpportunity(opportunity.id); $event.stopPropagation()
              "
            >
              Delete
            </button>
          </div>
        </div>
        }
      </div>
      }
    </div>

    <!-- ============================================
         SECTION 3: QUICK ACTIONS (Secondary)
         ============================================ -->
    @if (onboardingState()?.canCreateOpportunities) {
    <div class="mb-8 bg-white rounded-xl border-2 border-slate-200 p-6">
      <p
        class="text-sm font-semibold text-slate-600 uppercase tracking-widest mb-4"
      >
        Quick Actions
      </p>
      <div class="flex flex-col sm:flex-row gap-3">
        <button
          class="flex items-center justify-center gap-2 bg-teal-600 text-white font-bold rounded-lg px-6 py-2.5 text-sm hover:bg-teal-700 active:bg-teal-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2"
          (click)="createOpportunity()"
        >
          <lucide-icon [img]="PlusIcon" [size]="16" />
          <span>New</span>
        </button>
        <button
          class="flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-semibold rounded-lg px-6 py-2.5 text-sm hover:bg-slate-200 active:bg-slate-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 border border-slate-300"
          (click)="importOpportunity()"
        >
          <lucide-icon [img]="FileTextIcon" [size]="16" />
          <span>Import</span>
        </button>
      </div>
    </div>
    }

    <!-- ============================================
         SECTION 4: METRICS (Bottom, Minimal)
         ============================================ -->
    @if (analytics()) {
    <div class="mt-12 pt-8 border-t-2 border-slate-300">
      <p
        class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4"
      >
        Portfolio Overview
      </p>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <!-- Active Opportunities -->
        <div class="bg-white rounded-lg border border-slate-200 p-4">
          <p class="text-2xl font-black text-teal-600">
            {{ getActiveOpportunitiesCount() }}
          </p>
          <p class="text-xs text-slate-600 font-semibold mt-1">Active</p>
        </div>

        <!-- Pending Applications -->
        <div class="bg-white rounded-lg border border-slate-200 p-4">
          <p class="text-2xl font-black text-slate-900">
            {{ getPendingApplicationsCount() }}
          </p>
          <p class="text-xs text-slate-600 font-semibold mt-1">Pending Apps</p>
        </div>

        <!-- Conversion Rate -->
        <div class="bg-white rounded-lg border border-slate-200 p-4">
          <p class="text-2xl font-black text-slate-900">
            {{ analytics()!.averageConversionRate.toFixed(1) }}%
          </p>
          <p class="text-xs text-slate-600 font-semibold mt-1">Conversion</p>
        </div>

        <!-- Total Views -->
        <div class="bg-white rounded-lg border border-slate-200 p-4">
          <p class="text-2xl font-black text-slate-900">
            {{ formatNumber(analytics()!.totalViews) }}
          </p>
          <p class="text-xs text-slate-600 font-semibold mt-1">Total Views</p>
        </div>
      </div>
    </div>
    }
  </div>
</div>

<app-opportunity-action-modal></app-opportunity-action-modal>
