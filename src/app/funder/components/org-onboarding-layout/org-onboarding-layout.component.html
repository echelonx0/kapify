 

<div class="min-h-screen bg-neutral-50">
  <!-- Mobile Header -->
  <header class="lg:hidden bg-white border-b border-neutral-200 px-4 py-3 sticky top-0 z-40">
    <div class="flex items-center justify-between">
      <button (click)="toggleMobileNav()" class="p-2 -ml-2">
        <lucide-icon [img]="MenuIcon" [size]="24" class="text-neutral-600" />
      </button>
      
      <div class="text-center flex-1">
        <h1 class="text-lg font-semibold text-neutral-900">{{ getCurrentStepTitle() }}</h1>
        <div class="text-xs text-neutral-500">Step {{ getCurrentStepNumber() }} of {{ getTotalSteps() }}</div>
      </div>
      
      <div class="w-10 flex justify-end">
        <div class="text-right">
          <div class="text-xs font-medium text-primary-600">{{ getOverallProgress() }}%</div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Progress Bar -->
    <div class="mt-3">
      <div class="w-full bg-neutral-200 rounded-full h-1">
        <div 
          class="bg-primary-500 h-1 rounded-full transition-all duration-300"
          [style.width.%]="getOverallProgress()"
        ></div>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Desktop Sidebar -->
    <aside class="hidden lg:flex w-80 bg-white border-r border-neutral-200 flex-col sticky top-0 h-screen">
      <!-- Header -->
      <div class="p-6 border-b border-neutral-200">
        <!-- Breadcrumb -->
<div class="flex items-center text-sm text-neutral-600 mb-3">
  <button 
    (click)="goToFunderDashboard()" 
    class="flex items-center hover:text-primary-600 transition-colors"
  >
    <lucide-icon [img]="HomeIcon" [size]="16" class="mr-1" />
    <span>Funder</span>
  </button>
  <span class="mx-2">/</span>
  <span class="text-neutral-900 font-medium">Organization Setup</span>
</div>

        
        <!-- Overall Progress -->
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <h1 class="text-lg font-semibold text-neutral-900">Setup Progress</h1>
            <span class="text-sm font-medium text-primary-600">{{ getOverallProgress() }}%</span>
          </div>
          
          <div class="w-full bg-neutral-200 rounded-full h-2">
            <div 
              class="bg-primary-500 h-2 rounded-full transition-all duration-300"
              [style.width.%]="getOverallProgress()"
            ></div>
          </div>
          
          <div class="flex items-center justify-between text-sm">
            <span class="text-neutral-600">{{ getCompletedSteps() }} of {{ getTotalSteps() }} sections complete</span>
            <span class="text-neutral-500">~{{ getRemainingTime() }} remaining</span>
          </div>
        </div>
      </div>

      <!-- Step Navigation -->
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
        @for (step of getStepInfo(); track step.id; let i = $index) {
          <div class="relative">
            <!-- Connection Line -->
            @if (i < getStepInfo().length - 1) {
              <div class="absolute left-6 top-12 w-0.5 h-8 bg-neutral-200"></div>
            }
            
            <!-- Step Card -->
            <button
              (click)="goToStep(step.id)"
              [class]="getStepCardClasses(step)"
              [disabled]="!canAccessStep(step.id)"
              class="w-full text-left p-4 rounded-lg border transition-all duration-200"
            >
              <div class="flex items-start space-x-3">
                <!-- Step Icon -->
                <div [class]="getStepIconClasses(step)">
                  @if (step.completed) {
                    <lucide-icon [img]="CheckIcon" [size]="16" class="text-white" />
                  } @else {
                    <lucide-icon [img]="getStepIcon(step.id)" [size]="16" />
                  }
                </div>
                
                <!-- Step Content -->
                <div class="flex-1 min-w-0">
                  <div class="flex items-center justify-between">
                    <h3 [class]="getStepTitleClasses(step)">{{ step.shortTitle }}</h3>
                    @if (step.required) {
                      <span class="bg-red-100 text-red-600 text-xs px-2 py-1 rounded font-medium">Required</span>
                    }
                  </div>
                  
                  <p class="text-xs text-neutral-600 mt-1 line-clamp-2">{{ step.description }}</p>
                  
                  <!-- Status and Time -->
                  <div class="flex items-center justify-between mt-3">
                    <div class="flex items-center space-x-2">
                      @if (step.completed) {
                        <lucide-icon [img]="CheckCircleIcon" [size]="12" class="text-green-500" />
                        <span class="text-xs text-green-600 font-medium">Complete</span>
                      } @else if (isCurrentStep(step.id)) {
                        <lucide-icon [img]="ClockIcon" [size]="12" class="text-blue-500" />
                        <span class="text-xs text-blue-600 font-medium">In Progress</span>
                      } @else if (canAccessStep(step.id)) {
                        <span class="text-xs text-neutral-500">Available</span>
                      } @else {
                        <lucide-icon [img]="AlertCircleIcon" [size]="12" class="text-neutral-400" />
                        <span class="text-xs text-neutral-400">Locked</span>
                      }
                    </div>
                    
                    @if (!step.completed) {
                      <span class="text-xs text-neutral-500">{{ step.estimatedTime }}</span>
                    }
                  </div>
                </div>
              </div>
            </button>
          </div>
        }
      </nav>

 
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col min-h-screen lg:min-h-0">
      <!-- Desktop Content Header -->
      <header class="hidden lg:block bg-white border-b border-neutral-200 px-8 py-6 sticky top-0 z-40">
        <div class="max-w-4xl mx-auto">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-bold text-neutral-900">{{ getCurrentStepTitle() }}</h1>
              <p class="text-neutral-600 mt-1">{{ getCurrentStepDescription() }}</p>
            </div>
            
            <!-- Step Progress Indicator -->
            <div class="text-right">
              <div class="text-sm text-neutral-500">Step {{ getCurrentStepNumber() }} of {{ getTotalSteps() }}</div>
              <div class="text-xs text-neutral-400">{{ getCurrentStepEstimatedTime() }}</div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Body -->
      <div class="flex-1 overflow-y-auto">
        <div class="max-w-4xl mx-auto px-4 lg:px-8 py-6">
          <router-outlet />
        </div>
      </div>

      <!-- Action Footer -->
      <footer class="bg-white border-t border-neutral-200 px-4 lg:px-8 py-4 sticky bottom-0">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
          <!-- Back Button -->
          @if (!isFirstStep()) {
            <ui-button variant="outline" (clicked)="previousStep()">
              <lucide-icon [img]="ArrowLeftIcon" [size]="16" class="mr-2" />
              <span class="hidden sm:inline">Back</span>
            </ui-button>
          } @else {
            <div></div>
          }
          
          <!-- Primary Actions -->
          <div class="flex items-center space-x-3">
            <!-- UPDATED: Different actions based on current step -->
            @switch (onboardingService.currentStep()) {
              
              <!-- Step 1: Basic Info -->
              @case ('organization-info') {
                <ui-button 
                  variant="primary"
                  size="lg"
                  (clicked)="saveAndContinue()"
                  [disabled]="onboardingService.isSaving() || !onboardingService.isBasicInfoValid()"
                >
                  @if (onboardingService.isSaving()) {
                    <lucide-icon [img]="ClockIcon" [size]="16" class="mr-2 animate-spin" />
                    <span class="hidden sm:inline">Saving...</span>
                    <span class="sm:hidden">...</span>
                  } @else {
                    <span class="hidden sm:inline">Save & Continue to Legal Info</span>
                    <span class="sm:hidden">Next</span>
                    <lucide-icon [img]="ArrowRightIcon" [size]="16" class="ml-2" />
                  }
                </ui-button>
              }
              
              <!-- Step 2: Legal Info -->
              @case ('legal-compliance') {
                <ui-button 
                  variant="primary"
                  size="lg"
                  (clicked)="saveAndContinue()"
                  [disabled]="onboardingService.isSaving() || !onboardingService.isLegalInfoValid()"
                >
                  @if (onboardingService.isSaving()) {
                    <lucide-icon [img]="ClockIcon" [size]="16" class="mr-2 animate-spin" />
                    <span class="hidden sm:inline">Saving...</span>
                    <span class="sm:hidden">...</span>
                  } @else {
                    <span class="hidden sm:inline">Save & Continue to Verification</span>
                    <span class="sm:hidden">Next</span>
                    <lucide-icon [img]="ArrowRightIcon" [size]="16" class="ml-2" />
                  }
                </ui-button>
              }
              
              <!-- Step 3: Verification -->
              @case ('verification') {
                <div class="flex items-center space-x-3">
                  <ui-button 
                    variant="outline"
                    size="lg"
                    (clicked)="goToFunderDashboard()"
                  >
                    <span class="hidden sm:inline">Skip Verification</span>
                    <span class="sm:hidden">Skip</span>
                  </ui-button>
                  
                  <ui-button 
                    variant="primary"
                    size="lg"
                    (clicked)="submitForVerification()"
                    [disabled]="!canSubmit() || onboardingService.isSaving()"
                  >
                    @if (onboardingService.isSaving()) {
                      <lucide-icon [img]="ClockIcon" [size]="16" class="mr-2 animate-spin" />
                      <span class="hidden sm:inline">Submitting...</span>
                      <span class="sm:hidden">...</span>
                    } @else {
                      <lucide-icon [img]="ShieldIcon" [size]="16" class="mr-2" />
                      <span class="hidden sm:inline">Submit for Verification</span>
                      <span class="sm:hidden">Submit</span>
                    }
                  </ui-button>
                </div>
              }
              
              <!-- Default/Unknown step -->
              @default {
                <ui-button 
                  variant="primary"
                  size="lg"
                  (clicked)="saveAndContinue()"
                  [disabled]="onboardingService.isSaving()"
                >
                  @if (onboardingService.isSaving()) {
                    <lucide-icon [img]="ClockIcon" [size]="16" class="mr-2 animate-spin" />
                    <span class="hidden sm:inline">Saving...</span>
                  } @else {
                    <span class="hidden sm:inline">Save & Continue</span>
                    <span class="sm:hidden">Next</span>
                  }
                </ui-button>
              }
            }
          </div>
        </div>
      </footer>
    </main>
  </div>

  <!-- Mobile Navigation Overlay -->
  @if (showMobileNav()) {
    <div class="fixed inset-0 z-50 lg:hidden">
      <div class="fixed inset-0 bg-black bg-opacity-25" (click)="closeMobileNav()"></div>
      <div class="fixed inset-y-0 left-0 w-80 bg-white shadow-xl">
        <!-- Mobile Nav Header -->
        <div class="p-4 border-b border-neutral-200 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-neutral-900">Setup Steps</h2>
          <button (click)="closeMobileNav()" class="p-2 -mr-2">
            <lucide-icon [img]="XIcon" [size]="24" class="text-neutral-600" />
          </button>
        </div>

        <!-- Mobile Progress -->
        <div class="p-4 border-b border-neutral-200">
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm font-medium text-neutral-700">Progress</span>
            <span class="text-sm font-medium text-primary-600">{{ getOverallProgress() }}%</span>
          </div>
          
          <div class="w-full bg-neutral-200 rounded-full h-2 mb-3">
            <div 
              class="bg-primary-500 h-2 rounded-full transition-all duration-300"
              [style.width.%]="getOverallProgress()"
            ></div>
          </div>
          
          <div class="text-sm text-neutral-600">
            {{ getCompletedSteps() }} of {{ getTotalSteps() }} sections complete
          </div>
        </div>

        <!-- Mobile Step Navigation -->
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
          @for (step of getStepInfo(); track step.id; let i = $index) {
            <button
              (click)="goToStepAndCloseMobile(step.id)"
              [class]="getMobileStepCardClasses(step)"
              [disabled]="!canAccessStep(step.id)"
              class="w-full text-left p-3 rounded-lg border transition-all duration-200"
            >
              <div class="flex items-center space-x-3">
                <!-- Step Icon -->
                <div [class]="getStepIconClasses(step)">
                  @if (step.completed) {
                    <lucide-icon [img]="CheckIcon" [size]="14" class="text-white" />
                  } @else {
                    <span class="text-xs font-medium">{{ i + 1 }}</span>
                  }
                </div>
                
                <!-- Step Content -->
                <div class="flex-1 min-w-0">
                  <h3 [class]="getStepTitleClasses(step)">{{ step.shortTitle }}</h3>
                  
                  <!-- Status -->
                  <div class="flex items-center space-x-2 mt-1">
                    @if (step.completed) {
                      <span class="text-xs text-green-600 font-medium">Complete</span>
                    } @else if (isCurrentStep(step.id)) {
                      <span class="text-xs text-blue-600 font-medium">Current</span>
                    } @else if (canAccessStep(step.id)) {
                      <span class="text-xs text-neutral-500">Available</span>
                    } @else {
                      <span class="text-xs text-neutral-400">Locked</span>
                    }
                    
                    @if (step.required) {
                      <span class="bg-red-100 text-red-600 text-xs px-1.5 py-0.5 rounded">Required</span>
                    }
                  </div>
                </div>
              </div>
            </button>
          }
        </nav>

        <!-- Mobile Footer -->
        <div class="p-4 border-t border-neutral-200 space-y-2">
          <ui-button 
            variant="outline" 
            size="sm" 
            class="w-full"
            (clicked)="saveProgress()"
            [disabled]="onboardingService.isSaving()"
          >
            @if (onboardingService.isSaving()) {
              <lucide-icon [img]="ClockIcon" [size]="16" class="mr-2 animate-spin" />
              Saving...
            } @else {
              <lucide-icon [img]="SaveIcon" [size]="16" class="mr-2" />
              Save Progress
            }
          </ui-button>
          
          <ui-button 
            variant="ghost" 
            size="sm" 
            class="w-full text-neutral-600"
            (clicked)="requestHelp()"
          >
            Need Help?
          </ui-button>
          
          @if (onboardingService.lastSavedLocally()) {
            <div class="text-xs text-neutral-500 text-center">
              <lucide-icon [img]="CheckIcon" [size]="12" class="inline mr-1 text-green-500" />
              Last saved {{ getLastSavedText() }}
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>