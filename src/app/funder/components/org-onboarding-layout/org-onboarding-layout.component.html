<!-- src/app/funder/components/org-onboarding-layout/org-onboarding-layout.component.html -->
<!-- NEO-BRUTALIST VERSION -->

<div class="h-screen bg-white flex flex-col overflow-hidden">
  <!-- Mobile Header: Neo-Brutal -->
  <header
    class="lg:hidden bg-white border-b-3 border-slate-900 px-4 py-4 flex-shrink-0 z-40 slide-down"
  >
    <div class="flex items-center justify-between gap-4">
      <button
        (click)="toggleMobileNav()"
        class="p-2 -ml-2 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors duration-200 border-2 border-slate-300 font-bold"
      >
        <lucide-icon [img]="MenuIcon" [size]="20" class="text-slate-900" />
      </button>

      <div class="flex-1 text-center">
        <h1 class="text-sm font-black text-slate-900 uppercase tracking-wide">
          {{ getCurrentStepTitle() }}
        </h1>
        <p class="text-xs font-bold text-slate-600 mt-1">
          Step {{ getCurrentStepNumber() }} / {{ getTotalSteps() }}
        </p>
      </div>
    </div>

    <!-- Progress Bar: Thick, Bold -->
    <div
      class="mt-4 w-full bg-slate-200 rounded-lg h-3 overflow-hidden border-2 border-slate-300"
    >
      <div
        class="h-3 rounded-lg transition-all duration-700 ease-out bg-gradient-to-r from-teal-500 to-teal-600"
        [style.width.%]="getOverallProgress()"
      ></div>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden">
    <!-- Desktop Sidebar: Neo-Brutal -->
    <aside
      class="hidden lg:flex w-80 bg-white border-r-4 border-slate-900 flex-col overflow-hidden slide-in-left"
    >
      <!-- Header -->
      <div class="p-6 border-b-3 border-slate-300 flex-shrink-0">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-black text-slate-900 uppercase tracking-wide">
            Setup Progress
          </h2>
        </div>

        <!-- Progress Bar: Bold -->
        <div
          class="w-full bg-slate-200 rounded-lg h-3 overflow-hidden mb-4 border-2 border-slate-300"
        >
          <div
            class="h-3 rounded-lg transition-all duration-700 ease-out bg-gradient-to-r from-teal-500 to-teal-600"
            [style.width.%]="getOverallProgress()"
          ></div>
        </div>

        <!-- Stats -->
        <div
          class="flex items-center justify-between text-xs font-bold text-slate-700 uppercase tracking-wide"
        >
          <span>{{ getCompletedSteps() }}/{{ getTotalSteps() }} Complete</span>
          @if (getCompletedSteps() < getTotalSteps()) {
          <span>~{{ getRemainingTime() }} Left</span>
          }
        </div>
      </div>

      <!-- Step Navigation -->
      <nav class="flex-1 p-4 space-y-3 overflow-y-auto">
        @for (step of getStepInfo(); track step.id; let i = $index) {
        <button
          (click)="goToStep(step.id)"
          [disabled]="!canAccessStep(step.id)"
          class="step-card w-full text-left transition-all duration-200"
          [style.--delay]="i * 0.1 + 0.2 + 's'"
          [class.bg-teal-50]="isCurrentStep(step.id)"
          [class.border-3]="isCurrentStep(step.id) || step.completed"
          [class.border-teal-600]="isCurrentStep(step.id)"
          [class.border-green-600]="step.completed && !isCurrentStep(step.id)"
          [class.border-2]="!isCurrentStep(step.id) && !step.completed"
          [class.border-slate-300]="!isCurrentStep(step.id) && !step.completed"
          [class.hover:bg-slate-50]="
            !isCurrentStep(step.id) && !step.completed && canAccessStep(step.id)
          "
          [class.opacity-60]="!canAccessStep(step.id)"
          [class.cursor-not-allowed]="!canAccessStep(step.id)"
        >
          <div class="flex items-start gap-4 p-4">
            <!-- Icon: Bold Border -->
            <div
              [class.w-10]="true"
              [class.h-10]="true"
              [class.rounded-lg]="true"
              [class.flex]="true"
              [class.items-center]="true"
              [class.justify-center]="true"
              [class.flex-shrink-0]="true"
              [class.border-3]="true"
              [class.bg-green-100]="step.completed"
              [class.border-green-600]="step.completed"
              [class.bg-teal-100]="isCurrentStep(step.id) && !step.completed"
              [class.border-teal-600]="
                isCurrentStep(step.id) && !step.completed
              "
              [class.bg-slate-100]="!step.completed && !isCurrentStep(step.id)"
              [class.border-slate-400]="
                !step.completed && !isCurrentStep(step.id)
              "
            >
              @if (step.completed) {
              <lucide-icon
                [img]="CheckIcon"
                [size]="20"
                class="text-green-700"
              />
              } @else {
              <lucide-icon
                [img]="getStepIcon(step.id)"
                [size]="20"
                [class.text-teal-700]="isCurrentStep(step.id)"
                [class.text-slate-600]="!isCurrentStep(step.id)"
              />
              }
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between gap-2 mb-2">
                <h3
                  class="font-black text-slate-900 uppercase tracking-wide text-sm"
                  [class.text-teal-900]="isCurrentStep(step.id)"
                >
                  {{ step.shortTitle }}
                </h3>
                @if (step.required && !step.completed) {
                <span
                  class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-black bg-teal-100 text-teal-700 border-2 border-teal-400 uppercase tracking-wide"
                >
                  Required
                </span>
                }
              </div>

              <p class="text-xs font-medium text-slate-600 leading-snug mb-3">
                {{ step.description }}
              </p>

              <!-- Status Footer -->
              <div
                class="flex items-center justify-between pt-3 border-t-2 border-slate-300"
              >
                @if (step.completed) {
                <span
                  class="inline-flex items-center gap-1.5 text-xs font-bold text-green-700 uppercase tracking-wide"
                >
                  <lucide-icon [img]="CheckIcon" [size]="14" />
                  Complete
                </span>
                } @else if (isCurrentStep(step.id)) {
                <span
                  class="inline-flex items-center gap-1.5 text-xs font-bold text-teal-700 uppercase tracking-wide"
                >
                  <div
                    class="w-2 h-2 rounded-full bg-teal-600 animate-pulse"
                  ></div>
                  Current
                </span>
                } @else if (canAccessStep(step.id)) {
                <span
                  class="text-xs font-bold text-slate-700 uppercase tracking-wide"
                  >Available</span
                >
                } @else {
                <span
                  class="text-xs font-bold text-slate-400 uppercase tracking-wide"
                  >Locked</span
                >
                } @if (!step.completed) {
                <span
                  class="text-xs font-bold text-slate-600 uppercase tracking-wide"
                  >{{ step.estimatedTime }}</span
                >
                }
              </div>
            </div>
          </div>
        </button>
        }
      </nav>

      <!-- Footer: Verification CTA -->
      @if (isOnboardingComplete()) {
      <div class="p-6 border-t-3 border-slate-300 bg-teal-50 flex-shrink-0">
        <h3
          class="text-sm font-black text-teal-900 mb-2 uppercase tracking-wide"
        >
          Ready to Start Funding?
        </h3>
        <p class="text-xs font-medium text-teal-700 mb-4">
          Submit for verification to unlock funding opportunities
        </p>
        <button
          (click)="submitForVerification()"
          class="w-full bg-teal-600 text-white font-black py-3 px-4 rounded-lg hover:bg-teal-700 active:bg-teal-800 transition-all duration-200 border-3 border-teal-700 uppercase tracking-wide"
        >
          Submit
        </button>
      </div>
      } @else {
      <div class="p-6 border-t-3 border-slate-300 bg-slate-100 flex-shrink-0">
        <div class="flex items-start gap-3">
          <lucide-icon
            [img]="getStepIcon('organization-info')"
            [size]="16"
            class="text-slate-600 flex-shrink-0 mt-0.5"
          />
          <p class="text-xs font-medium text-slate-700">
            Progress is automatically saved as you go
          </p>
        </div>
      </div>
      }
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden bg-slate-50">
      <div class="flex-1 overflow-y-auto">
        <div class="max-w-4xl mx-auto px-4 lg:px-8 py-8 fade-in">
          <router-outlet />
        </div>
      </div>
    </main>
  </div>

  <!-- Mobile Navigation Drawer: Neo-Brutal -->
  @if (showMobileNav()) {
  <div class="fixed inset-0 z-50 lg:hidden">
    <!-- Backdrop -->
    <div
      class="fixed inset-0 bg-black/40 backdrop-blur-sm"
      (click)="closeMobileNav()"
    ></div>

    <!-- Drawer -->
    <div
      class="fixed inset-y-0 left-0 w-80 max-w-[85vw] bg-white shadow-2xl flex flex-col drawer-slide-in border-r-4 border-slate-900"
    >
      <!-- Header -->
      <div
        class="p-6 border-b-3 border-slate-300 flex items-center justify-between flex-shrink-0"
      >
        <h2 class="text-base font-black text-slate-900 uppercase tracking-wide">
          Setup Steps
        </h2>
        <button
          (click)="closeMobileNav()"
          class="p-2 -mr-2 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors border-2 border-slate-300 font-bold"
        >
          <lucide-icon [img]="XIcon" [size]="20" class="text-slate-900" />
        </button>
      </div>

      <!-- Progress Section -->
      <div class="p-6 border-b-3 border-slate-300 bg-slate-100 flex-shrink-0">
        <div class="flex items-center justify-between mb-4">
          <span
            class="text-sm font-black text-slate-900 uppercase tracking-wide"
            >Overall Progress</span
          >
          <div class="flex items-center gap-2">
            <span class="text-2xl font-black text-teal-600">
              {{ getOverallProgress() }}%
            </span>
          </div>
        </div>

        <div
          class="w-full bg-slate-200 rounded-lg h-3 overflow-hidden mb-4 border-2 border-slate-300"
        >
          <div
            class="h-3 rounded-lg transition-all duration-700 ease-out bg-gradient-to-r from-teal-500 to-teal-600"
            [style.width.%]="getOverallProgress()"
          ></div>
        </div>

        <div
          class="flex items-center justify-between text-xs font-bold text-slate-700 uppercase tracking-wide"
        >
          <span>{{ getCompletedSteps() }}/{{ getTotalSteps() }} Complete</span>
          @if (getCompletedSteps() < getTotalSteps()) {
          <span>{{ getRemainingTime() }} Left</span>
          }
        </div>
      </div>

      <!-- Steps List -->
      <nav class="flex-1 p-4 space-y-3 overflow-y-auto">
        @for (step of getStepInfo(); track step.id) {
        <button
          (click)="goToStepAndCloseMobile(step.id)"
          [disabled]="!canAccessStep(step.id)"
          class="w-full text-left transition-all duration-200 p-4 rounded-lg border-2"
          [class.bg-teal-50]="isCurrentStep(step.id)"
          [class.border-3]="isCurrentStep(step.id) || step.completed"
          [class.border-teal-600]="isCurrentStep(step.id)"
          [class.border-green-600]="step.completed && !isCurrentStep(step.id)"
          [class.border-slate-300]="!isCurrentStep(step.id) && !step.completed"
          [class.hover:bg-slate-50]="
            !isCurrentStep(step.id) && !step.completed && canAccessStep(step.id)
          "
          [class.opacity-60]="!canAccessStep(step.id)"
          [class.cursor-not-allowed]="!canAccessStep(step.id)"
        >
          <div class="flex items-start gap-3">
            <!-- Icon -->
            <div
              class="w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 border-3"
              [class.bg-green-100]="step.completed"
              [class.border-green-600]="step.completed"
              [class.bg-teal-100]="isCurrentStep(step.id) && !step.completed"
              [class.border-teal-600]="
                isCurrentStep(step.id) && !step.completed
              "
              [class.bg-slate-100]="!step.completed && !isCurrentStep(step.id)"
              [class.border-slate-400]="
                !step.completed && !isCurrentStep(step.id)
              "
            >
              @if (step.completed) {
              <lucide-icon
                [img]="CheckIcon"
                [size]="18"
                class="text-green-700"
              />
              } @else {
              <lucide-icon
                [img]="getStepIcon(step.id)"
                [size]="18"
                [class.text-teal-700]="isCurrentStep(step.id)"
                [class.text-slate-600]="!isCurrentStep(step.id)"
              />
              }
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between gap-2 mb-1">
                <h3
                  class="font-black text-slate-900 uppercase tracking-wide text-sm"
                  [class.text-teal-900]="isCurrentStep(step.id)"
                >
                  {{ step.shortTitle }}
                </h3>
                @if (isCurrentStep(step.id)) {
                <div
                  class="w-2 h-2 rounded-full bg-teal-600 animate-pulse"
                ></div>
                }
              </div>
              <div class="flex items-center gap-2 mt-1">
                @if (step.completed) {
                <span
                  class="text-xs font-black text-green-700 uppercase tracking-wide"
                  >Complete</span
                >
                } @else if (isCurrentStep(step.id)) {
                <span
                  class="text-xs font-black text-teal-700 uppercase tracking-wide"
                  >Current</span
                >
                } @else if (canAccessStep(step.id)) {
                <span
                  class="text-xs font-bold text-slate-700 uppercase tracking-wide"
                  >Available</span
                >
                } @else {
                <span
                  class="text-xs font-bold text-slate-400 uppercase tracking-wide"
                  >Locked</span
                >
                }
                <span class="text-xs font-bold text-slate-400">â€¢</span>
                <span
                  class="text-xs font-bold text-slate-600 uppercase tracking-wide"
                  >{{ step.estimatedTime }}</span
                >
              </div>
            </div>
          </div>
        </button>
        }
      </nav>

      <!-- Mobile Verification CTA -->
      @if (isOnboardingComplete()) {
      <div class="p-6 border-t-3 border-slate-300 bg-teal-50 flex-shrink-0">
        <h3
          class="text-sm font-black text-teal-900 mb-2 uppercase tracking-wide"
        >
          Ready to Start Funding?
        </h3>
        <p class="text-xs font-medium text-teal-700 mb-4">
          Submit for verification to unlock funding opportunities
        </p>
        <button
          (click)="submitForVerification(); closeMobileNav()"
          class="w-full bg-teal-600 text-white font-black py-3 px-4 rounded-lg hover:bg-teal-700 active:bg-teal-800 transition-all duration-200 border-3 border-teal-700 uppercase tracking-wide"
        >
          Submit
        </button>
      </div>
      }
    </div>
  </div>
  }
</div>
