<!-- src/app/funder/components/application-detail/components/business-info/business-info.component.html -->

<!-- Business Core Info Grid (Top) -->
@if (getBusinessInfo()) {
<div class="space-y-6">
  <!-- Business Name + Core Details Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    @if (getBusinessInfo()!.companyName) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">Company Name</p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.companyName }}
          </p>
        </div>
      </div>
    </div>
    } @if (getBusinessInfo()!.registrationNumber) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">
            Registration Number
          </p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.registrationNumber }}
          </p>
        </div>
      </div>
    </div>
    } @if (getBusinessInfo()!.vatNumber) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">VAT Number</p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.vatNumber }}
          </p>
        </div>
      </div>
    </div>
    } @if (getBusinessInfo()!.industry) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">Industry</p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.industry }}
          </p>
        </div>
      </div>
    </div>
    } @if (getBusinessInfo()!.yearsInOperation) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">
            Years in Operation
          </p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.yearsInOperation }} years
          </p>
        </div>
      </div>
    </div>
    } @if (getBusinessInfo()!.numberOfEmployees) {
    <div class="bg-white border border-slate-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <div class="flex-1 min-w-0">
          <p class="text-xs font-medium text-slate-500 mb-1">
            Number of Employees
          </p>
          <p class="text-sm font-semibold text-slate-900">
            {{ getBusinessInfo()!.numberOfEmployees }}
          </p>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Primary Contact (Replaces Physical Address) -->
  @if (getPrimaryContact(); as contact) {
  <div class="bg-white border border-slate-200 rounded-xl p-6">
    <div class="flex items-start gap-3 mb-4">
      <div
        class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0"
      >
        <lucide-icon [img]="UserIcon" [size]="20" class="text-teal-600" />
      </div>
      <div class="flex-1 min-w-0">
        <h3 class="text-sm font-semibold text-slate-900 mb-1">
          Primary Contact
        </h3>
      </div>
    </div>

    <div class="space-y-3">
      <!-- Name & Position -->
      @if (contact.fullName) {
      <div>
        <p class="text-sm font-semibold text-slate-900">
          {{ contact.fullName }}
        </p>
        @if (contact.position) {
        <p class="text-sm text-slate-600">
          {{ contact.position }}
        </p>
        }
      </div>
      }

      <!-- Email -->
      @if (contact.email) {
      <div class="flex items-center gap-2 text-sm text-slate-700">
        <lucide-icon [img]="MailIcon" [size]="16" class="text-slate-500" />
        <span>{{ contact.email }}</span>
      </div>
      }

      <!-- Phone -->
      @if (contact.phone) {
      <div class="flex items-center gap-2 text-sm text-slate-700">
        <lucide-icon [img]="PhoneIcon" [size]="16" class="text-slate-500" />
        <span>{{ contact.phone }}</span>
      </div>
      }

      <!-- Address -->
      @if (contact.address) {
      <div class="flex items-start gap-2 text-sm text-slate-700">
        <lucide-icon
          [img]="MapPinIcon"
          [size]="16"
          class="text-slate-500 mt-0.5"
        />
        <span>{{ contact.address }}</span>
      </div>
      }
    </div>
  </div>
  }

  <!-- Business Description (Full Width) -->
  @if (getBusinessDescription()) {
  <div class="bg-white border border-slate-200 rounded-xl p-6">
    <div class="flex items-start gap-3 mb-3">
      <div
        class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center flex-shrink-0"
      >
        <lucide-icon [img]="FileTextIcon" [size]="16" class="text-slate-600" />
      </div>
      <h3 class="text-sm font-semibold text-slate-900">About this Business</h3>
    </div>
    <p class="text-sm text-slate-700 leading-relaxed">
      {{ getBusinessDescription() }}
    </p>
  </div>
  }

  <!-- Executive Rosters (Table Row Layout) -->
  <div class="space-y-6">
    @for (roster of rosters; track roster.id) {
    <div
      class="bg-white border rounded-xl overflow-hidden"
      [ngClass]="'border-' + getRosterColor(roster.color).border"
    >
      <!-- Roster Header (Collapsible) -->
      <button
        (click)="toggleRoster(roster.id)"
        [ngClass]="getRosterColor(roster.color).bg"
        class="w-full px-6 py-4 border-b border-slate-200 flex items-center justify-between hover:opacity-80 transition-opacity duration-200"
      >
        <div class="flex items-center gap-2">
          <div
            [ngClass]="'bg-' + roster.color + '-100'"
            class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0"
          >
            <lucide-icon
              [img]="UsersIcon"
              [size]="16"
              [ngClass]="getRosterColor(roster.color).icon"
            />
          </div>
          <h3
            [ngClass]="getRosterColor(roster.color).text"
            class="font-semibold text-sm"
          >
            {{ roster.title }}
          </h3>
        </div>
        <div class="flex items-center gap-2">
          <span
            [ngClass]="getRosterColor(roster.color).text"
            class="text-xs font-semibold"
          >
            {{ getRosterMembers(roster.id).length }}
          </span>
          <lucide-icon
            [img]="ChevronDownIcon"
            [size]="16"
            [ngClass]="getRosterColor(roster.color).icon"
            [class.rotate-180]="isRosterExpanded(roster.id)"
            class="transition-transform duration-200"
          />
        </div>
      </button>

      <!-- Column Headers (Visible when expanded and has members) -->
      @if (isRosterExpanded(roster.id) && getRosterMembers(roster.id).length >
      0) {
      <div
        class="grid gap-4 px-6 py-2.5 bg-slate-50/50 border-b border-slate-200"
        [ngClass]="{
          'grid-cols-3': roster.id === 'shareholders',
          'grid-cols-5': roster.id !== 'shareholders'
        }"
      >
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            {{ roster.id === "shareholders" ? "Name" : "Name & Surname" }}
          </p>
        </div>
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            {{ roster.id === "shareholders" ? "Role" : "Department" }}
          </p>
        </div>
        @if (roster.id !== 'shareholders') {
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            Qualification
          </p>
        </div>
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            Field of Study
          </p>
        </div>
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            Experience
          </p>
        </div>
        } @else {
        <div class="flex items-center">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
          >
            Ownership %
          </p>
        </div>
        }
      </div>
      }

      <!-- Roster Content (Table Rows) -->
      @if (isRosterExpanded(roster.id)) {
      <div class="max-h-96 overflow-y-auto">
        @if (getRosterMembers(roster.id).length > 0) { @for (member of
        getRosterMembers(roster.id); track member.id) { @if (roster.id ===
        'shareholders') {
        <!-- Shareholder Row -->
        <div
          class="grid grid-cols-3 gap-4 px-6 py-4 border-b border-slate-200 hover:bg-slate-50/50 transition-colors duration-200"
        >
          <div class="flex items-center">
            <p class="text-sm font-medium text-slate-900">
              {{ member.fullName }}
            </p>
          </div>
          <div class="flex items-center">
            <p class="text-sm text-slate-600">
              {{ member.role }}
            </p>
          </div>
          <div class="flex items-center">
            <span
              class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-amber-50 text-amber-700 border border-amber-200/50"
            >
              {{
                isShareholder(member) && member.ownershipPercentage
                  ? member.ownershipPercentage
                  : "â€”"
              }}
            </span>
          </div>
        </div>
        } @else {
        <!-- Team Member Row (using existing component) -->
        <app-team-member [member]="member"></app-team-member>
        } } } @else {
        <div class="px-6 py-4 text-xs text-slate-500 text-center">
          No members added yet
        </div>
        }
      </div>
      } @else {
      <div class="px-6 py-4 text-xs text-slate-500">
        {{ getRosterMembers(roster.id).length }} member(s)
      </div>
      }
    </div>
    }
  </div>
</div>
}
