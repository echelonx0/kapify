<div class="min-h-screen bg-gray-50">
  <div class="mx-auto px-4 sm:px-6 lg:px-8 py-8" style="max-width: 1360px">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <ui-button variant="outline" (clicked)="goBack()" class="shadow-sm">
          <lucide-icon [img]="ArrowLeftIcon" [size]="16" class="mr-2" />
          Go Back
        </ui-button>

        <div class="flex items-center gap-3">
          @if (profileExists()) {
          <ui-button
            variant="outline"
            (clicked)="previewProfile()"
            [disabled]="!profile()?.slug"
          >
            <lucide-icon [img]="EyeIcon" [size]="16" class="mr-2" />
            Preview
          </ui-button>

          @if (profile()?.isPublished) {
          <ui-button
            variant="outline"
            (clicked)="viewPublicProfile()"
            [disabled]="!profile()?.slug"
          >
            <lucide-icon [img]="ExternalLinkIcon" [size]="16" class="mr-2" />
            View Live
          </ui-button>
          } @else {
          <ui-button
            variant="primary"
            (clicked)="publishProfile()"
            [disabled]="!canPublish()"
          >
            <lucide-icon [img]="GlobeIcon" [size]="16" class="mr-2" />
            {{ isPublishing() ? "Publishing..." : "Publish" }}
          </ui-button>
          } } @else {
          <ui-button
            variant="primary"
            (clicked)="createProfile()"
            [disabled]="!isFormValid() || isCreating()"
          >
            <lucide-icon [img]="PlusIcon" [size]="16" class="mr-2" />
            {{ isCreating() ? "Creating..." : "Create Profile" }}
          </ui-button>
          }
        </div>
      </div>

      <!-- Profile URL Preview -->
      @if (profile()?.slug || profileForm.get('tagline')?.value) {
      <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-center gap-2 text-sm">
          <lucide-icon [img]="GlobeIcon" [size]="14" class="text-blue-600" />
          <span class="text-blue-600 font-medium">Public URL:</span>
          <code class="text-blue-800"
            >kapify.africa/funder/{{ getSlugPreview() }}</code
          >
        </div>
      </div>
      }

      <!-- Validation Summary -->
      @if (!isFormValid() && profileForm.touched) {
      <div class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
        <div class="flex items-start gap-3">
          <lucide-icon
            [img]="AlertCircleIcon"
            [size]="20"
            class="text-red-600 mt-0.5"
          />
          <div>
            <h4 class="text-red-800 font-medium mb-2">
              Complete these required fields to publish:
            </h4>
            <ul class="text-red-700 text-sm space-y-1">
              @if (hasFieldError('tagline')) {
              <li>• {{ getFieldError("tagline") }}</li>
              } @if (hasFieldError('investmentMin')) {
              <li>• {{ getFieldError("investmentMin") }}</li>
              } @if (hasFieldError('investmentMax')) {
              <li>• {{ getFieldError("investmentMax") }}</li>
              } @if (hasFieldError('investmentRange')) {
              <li>• {{ getFieldError("investmentRange") }}</li>
              }
            </ul>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
      <!-- Main Form Content (3/4 width) -->
      <div class="xl:col-span-3">
        <form
          [formGroup]="profileForm"
          (ngSubmit)="saveProfile()"
          class="space-y-8"
        >
          <!-- Hero Section -->
          <div class="section-card">
            <div class="section-header">
              <div>
                <h1 class="text-2xl font-bold text-gray-900">Public Profile</h1>
                <p class="text-gray-600 mt-1">
                  Customize your public funder page to attract high-quality
                  applications
                </p>
              </div>
            </div>
            <div class="p-6 space-y-6">
              <!-- Tagline -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  What is your Fund Mission/Vision?
                </label>
                <input
                  type="text"
                  formControlName="tagline"
                  placeholder="e.g., Empowering South African entrepreneurs to scale"
                  class="form-input"
                  [class.error]="hasFieldError('tagline')"
                  maxlength="120"
                />
                @if (hasFieldError('tagline')) {
                <div class="form-error">
                  <lucide-icon
                    [img]="AlertCircleIcon"
                    [size]="14"
                    class="mr-1"
                  />
                  {{ getFieldError("tagline") }}
                </div>
                }
                <p class="text-xs text-gray-500 mt-1">
                  {{ profileForm.get("tagline")?.value?.length || 0 }}/120
                  characters
                </p>
              </div>
              <!-- LOGO UPLOAD -->
              <div class="border-t border-slate-200 pt-6">
                <h3 class="text-sm font-semibold text-slate-900 mb-4">
                  Profile Logo
                </h3>

                <app-public-profile-logo-upload
                  imageType="logo"
                  [currentImageUrl]="profileForm.get('logoUrl')?.value"
                  (imageUploaded)="onLogoUploaded($event)"
                  (imageRemoved)="onLogoRemoved()"
                />
              </div>

              <!-- HERO IMAGE UPLOAD -->
              <div class="border-t border-slate-200 pt-6 mt-6">
                <h3 class="text-sm font-semibold text-slate-900 mb-4">
                  Public Image
                </h3>

                <app-public-profile-logo-upload
                  imageType="hero"
                  [currentImageUrl]="profileForm.get('heroImageUrl')?.value"
                  (imageUploaded)="onHeroImageUploaded($event)"
                  (imageRemoved)="onHeroImageRemoved()"
                />

                <p class="text-xs text-slate-600 mt-2">
                  Recommended: 1200x600px
                </p>
              </div>
              <!-- Elevator Pitch -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  A public facing description of your organisation
                </label>
                <textarea
                  formControlName="elevator_pitch"
                  placeholder="2-3 sentences describing your investment focus and value proposition"
                  class="form-textarea"
                  rows="3"
                  maxlength="300"
                ></textarea>
                <p class="text-xs text-gray-500 mt-1">
                  {{
                    profileForm.get("elevator_pitch")?.value?.length || 0
                  }}/300 characters
                </p>
              </div>

              <!-- Hero Video -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Fund introduction Video (Optional)
                </label>
                <div class="flex gap-3">
                  <input
                    type="url"
                    formControlName="heroVideoUrl"
                    placeholder="YouTube or Vimeo URL"
                    class="form-input flex-1"
                  />
                  <ui-button
                    type="button"
                    variant="outline"
                    (clicked)="uploadVideo()"
                  >
                    <lucide-icon [img]="UploadIcon" [size]="16" class="mr-2" />
                    Upload
                  </ui-button>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                  A 30-60 second introduction video increases applications by
                  40%
                </p>
              </div>
            </div>
          </div>

          <!-- Social Proof -->
          <div class="section-card">
            <div class="section-header">
              <h2 class="section-title">Social Proof & Metrics</h2>
              <p class="section-description">
                Showcase your track record and credibility
              </p>
            </div>
            <div class="p-6 space-y-6">
              <!-- Portfolio Highlights -->
              <div>
                <div class="flex items-center justify-between mb-2">
                  <label class="block text-sm font-medium text-gray-700">
                    Portfolio Highlights
                  </label>
                  <ui-button
                    type="button"
                    variant="outline"
                    size="sm"
                    (clicked)="addPortfolioHighlight()"
                  >
                    <lucide-icon [img]="PlusIcon" [size]="14" class="mr-1" />
                    Add
                  </ui-button>
                </div>
                <div class="space-y-2" formArrayName="portfolioHighlights">
                  @for (control of portfolioHighlightsArray.controls; track
                  $index) {
                  <div class="flex gap-2 items-center">
                    <input
                      type="text"
                      [formControlName]="$index"
                      placeholder="e.g., Funded 50+ companies"
                      class="form-input flex-1"
                    />
                    <ui-button
                      type="button"
                      variant="ghost"
                      size="sm"
                      (clicked)="removePortfolioHighlight($index)"
                    >
                      <lucide-icon
                        [img]="Trash2Icon"
                        [size]="14"
                        class="text-red-500"
                      />
                    </ui-button>
                  </div>
                  }
                </div>
                <p class="text-xs text-gray-500 mt-1">
                  Examples: "Funded 100+ SMEs", "R2.5B+ deployed", "95%
                  portfolio survival rate"
                </p>
              </div>

              <!-- Success Metrics -->
              <div>
                <div class="flex items-center justify-between mb-2">
                  <label class="block text-sm font-medium text-gray-700">
                    Key Metrics
                  </label>
                  <ui-button
                    type="button"
                    variant="outline"
                    size="sm"
                    (clicked)="addSuccessMetric()"
                  >
                    <lucide-icon [img]="PlusIcon" [size]="14" class="mr-1" />
                    Add Metric
                  </ui-button>
                </div>
                <div class="space-y-3" formArrayName="successMetrics">
                  @for (metricGroup of successMetricsArray.controls; track
                  $index) {
                  <div [formGroupName]="$index" class="metric-card">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                      <div>
                        <input
                          type="text"
                          formControlName="label"
                          placeholder="Metric label"
                          class="form-input"
                        />
                      </div>
                      <div>
                        <input
                          type="text"
                          formControlName="value"
                          placeholder="Value"
                          class="form-input"
                        />
                      </div>
                      <div class="flex gap-2">
                        <label class="flex items-center">
                          <input
                            type="checkbox"
                            formControlName="emphasis"
                            class="form-checkbox mr-2"
                          />
                          <span class="text-sm">Highlight</span>
                        </label>
                        <ui-button
                          type="button"
                          variant="ghost"
                          size="sm"
                          (clicked)="removeSuccessMetric($index)"
                        >
                          <lucide-icon
                            [img]="Trash2Icon"
                            [size]="14"
                            class="text-red-500"
                          />
                        </ui-button>
                      </div>
                    </div>
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Investment Details -->
          <div class="section-card">
            <div class="section-header">
              <h2 class="section-title">Investment Details</h2>
              <p class="section-description">
                Help SMEs understand if they're a fit
              </p>
            </div>
            <div class="p-6 space-y-8">
              <!-- Investment Range -->
              <div>
                <label class="block text-sm font-semibold text-slate-900 mb-3">
                  Investment Range *
                </label>
                <div
                  class="grid grid-cols-1 md:grid-cols-3 gap-4"
                  formGroupName="investmentRange"
                >
                  <div>
                    <label class="block text-xs text-slate-500 mb-2"
                      >Minimum (R)</label
                    >
                    <input
                      type="number"
                      formControlName="min"
                      placeholder="100000"
                      class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
                      [class.border-red-300]="hasFieldError('investmentMin')"
                    />
                    @if (hasFieldError('investmentMin')) {
                    <div
                      class="flex items-center gap-2 mt-2 text-sm text-red-700"
                    >
                      <lucide-icon [img]="AlertCircleIcon" [size]="14" />
                      <span>{{ getFieldError("investmentMin") }}</span>
                    </div>
                    }
                  </div>
                  <div>
                    <label class="block text-xs text-slate-500 mb-2"
                      >Maximum (R)</label
                    >
                    <input
                      type="number"
                      formControlName="max"
                      placeholder="5000000"
                      class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
                      [class.border-red-300]="hasFieldError('investmentMax')"
                    />
                    @if (hasFieldError('investmentMax')) {
                    <div
                      class="flex items-center gap-2 mt-2 text-sm text-red-700"
                    >
                      <lucide-icon [img]="AlertCircleIcon" [size]="14" />
                      <span>{{ getFieldError("investmentMax") }}</span>
                    </div>
                    }
                  </div>
                  <div>
                    <label class="block text-xs text-slate-500 mb-2"
                      >Typical (R)</label
                    >
                    <input
                      type="number"
                      formControlName="typical"
                      placeholder="500000"
                      class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
                    />
                  </div>
                </div>
                @if (hasFieldError('investmentRange')) {
                <div class="flex items-center gap-2 mt-3 text-sm text-red-700">
                  <lucide-icon [img]="AlertCircleIcon" [size]="14" />
                  <span>{{ getFieldError("investmentRange") }}</span>
                </div>
                }
              </div>

              <!-- Funding Areas & Industries (Full Width, Stacked) -->
              <div class="border-t border-slate-200/50 pt-8">
                <div class="flex items-center justify-between mb-4">
                  <label class="block text-sm font-semibold text-slate-900">
                    Funding Areas & Industries
                  </label>
                  <ui-button
                    type="button"
                    variant="outline"
                    size="sm"
                    (clicked)="addFundingArea()"
                    class="gap-1.5"
                  >
                    <lucide-icon [img]="PlusIcon" [size]="16" />
                    <span>Add Area</span>
                  </ui-button>
                </div>

                <div class="space-y-3" formArrayName="fundingAreas">
                  @for (areaGroup of fundingAreasArray.controls; track $index) {
                  <div [formGroupName]="$index" class="flex gap-3 items-start">
                    <input
                      type="text"
                      formControlName="name"
                      placeholder="e.g., Technology, Healthcare, Agriculture"
                      class="flex-1 px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
                    />
                    <ui-button
                      type="button"
                      variant="ghost"
                      size="sm"
                      (clicked)="removeFundingArea($index)"
                      class="mt-0.5 text-slate-400 hover:text-red-600 transition-colors"
                    >
                      <lucide-icon [img]="Trash2Icon" [size]="18" />
                    </ui-button>
                  </div>
                  }
                </div>

                @if (fundingAreasArray.length === 0) {
                <p class="text-sm text-slate-500 italic mt-2">
                  No areas added yet. Click "Add Area" to get started.
                </p>
                }
              </div>

              <!-- Response Time Promise (Full Width, Separate Section) -->
              <div class="border-t border-slate-200/50 pt-8">
                <label class="block text-sm font-semibold text-slate-900 mb-3">
                  Response Time Promise
                </label>
                <input
                  type="text"
                  formControlName="responseTimePromise"
                  placeholder="e.g., We respond within 48 hours"
                  class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
                />
                <p class="text-xs text-slate-500 mt-2">
                  Set clear expectations to build trust with applicants
                </p>
              </div>
            </div>
          </div>

          <!-- Social Links -->
          <div class="section-card">
            <div class="section-header">
              <h2 class="section-title">Social Links</h2>
              <p class="section-description">
                Build credibility with your online presence
              </p>
            </div>
            <div class="p-6">
              <div class="space-y-3" formArrayName="socialLinks">
                @for (linkGroup of socialLinksArray.controls; track $index) {
                <div [formGroupName]="$index" class="flex gap-3 items-center">
                  <select formControlName="platform" class="form-select">
                    <option value="linkedin">LinkedIn</option>
                    <option value="twitter">Twitter</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="youtube">YouTube</option>
                    <option value="website">Website</option>
                  </select>
                  <input
                    type="url"
                    formControlName="url"
                    placeholder="https://..."
                    class="form-input flex-1"
                  />
                  <ui-button
                    type="button"
                    variant="ghost"
                    size="sm"
                    (clicked)="removeSocialLink($index)"
                  >
                    <lucide-icon
                      [img]="Trash2Icon"
                      [size]="14"
                      class="text-red-500"
                    />
                  </ui-button>
                </div>
                }
              </div>
              <ui-button
                type="button"
                variant="outline"
                (clicked)="addSocialLink()"
                class="mt-3"
              >
                <lucide-icon [img]="PlusIcon" [size]="16" class="mr-2" />
                Add Social Link
              </ui-button>
            </div>
          </div>

          <!-- About Section -->
          <div class="section-card">
            <div class="section-header">
              <h2 class="section-title">About</h2>
              <p class="section-description">
                Tell your story and investment approach
              </p>
            </div>
            <div class="p-6 space-y-6">
              <!-- Founding Story -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Founding Story (Optional)
                </label>
                <textarea
                  formControlName="foundingStory"
                  placeholder="Why did you start this fund? What drives your investment philosophy?"
                  class="form-textarea"
                  rows="4"
                ></textarea>
              </div>

              <!-- Investment Approach -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Value Proposition
                </label>
                <textarea
                  formControlName="investmentApproach"
                  placeholder="How do you evaluate investments? What support do you provide?"
                  class="form-textarea"
                  rows="4"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Save Actions -->
          <div
            class="sticky bottom-0 bg-white border-t border-gray-200 p-4 -mx-4 rounded-lg shadow-sm"
          >
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-500">
                @if (lastSaved()) {
                <span class="text-green-600 font-medium"
                  >✓ Last saved: {{ formatLastSaved() }}</span
                >
                } @else if (hasChanges()) {
                <span class="text-orange-600">Changes not saved</span>
                } @else {
                <span>No changes</span>
                }
              </div>

              <div class="flex gap-3">
                <ui-button
                  type="button"
                  variant="outline"
                  (clicked)="saveDraft()"
                  [disabled]="!canSave()"
                >
                  <lucide-icon [img]="SaveIcon" [size]="16" class="mr-2" />
                  {{ isSaving() ? "Saving..." : "Save Draft" }}
                </ui-button>

                @if (profileExists() && !profile()?.isPublished) {
                <ui-button
                  type="button"
                  variant="primary"
                  (clicked)="publishProfile()"
                  [disabled]="!canPublish()"
                >
                  <lucide-icon [img]="GlobeIcon" [size]="16" class="mr-2" />
                  {{ isPublishing() ? "Publishing..." : "Publish Profile" }}
                </ui-button>
                }
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Right Sidebar (1/4 width) -->
      <div class="xl:col-span-1">
        <div class="sticky top-8 space-y-6">
          <!-- AI Profile Optimization Widget -->
          <app-profile-optimization-widget />
        </div>
      </div>
    </div>
  </div>
</div>
