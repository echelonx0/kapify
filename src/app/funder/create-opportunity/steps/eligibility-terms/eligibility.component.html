<!-- src/app/funder/create-opportunity/steps/eligibility-terms/eligibility.component.html -->
<div class="space-y-6">
  <!-- Investment Philosophy (as list) -->
  <app-criteria-chip-list
    [label]="'Investment Philosophy / Eligibility Criteria'"
    [placeholder]="'e.g., Focus on tech startups with proven revenue'"
    [field]="'investmentCriteria'"
    [hint]="
      'Define your investment thesis. Each criterion helps SMEs understand your approach.'
    "
  ></app-criteria-chip-list>

  <!-- Exclusion Criteria (as list) -->
  <app-criteria-chip-list
    [label]="'Automatic Exclusion Criteria'"
    [placeholder]="'e.g., Debt-to-revenue ratio > 50%'"
    [field]="'exclusionCriteria'"
    [hint]="
      'Criteria that automatically disqualify applicants. Leave empty for no automatic exclusions.'
    "
  ></app-criteria-chip-list>

  <!-- Dropdown Multiselects Row -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <!-- Target Industries -->
    <div
      class="relative"
      (clickOutside)="ui.closeDropdown('targetIndustriesOpen')"
    >
      <label class="block text-sm font-semibold text-slate-900 mb-2"
        >Target Industries</label
      >
      <button
        type="button"
        (click)="ui.toggleDropdown('targetIndustriesOpen')"
        class="w-full flex justify-between items-center px-4 py-2.5 border border-slate-200 rounded-xl bg-white text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
      >
        <span class="truncate text-left">
          {{
            formState.formData().targetIndustries.length
              ? formState.formData().targetIndustries.length + " selected"
              : "Select industries"
          }}
        </span>
      </button>

      @if (ui.targetIndustriesOpen()) {
      <div
        class="absolute z-20 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg p-3 max-h-60 overflow-y-auto"
      >
        <!-- Select All Option -->
        <label
          class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-slate-100 cursor-pointer transition border-b border-slate-200 mb-2"
        >
          <input
            type="checkbox"
            [checked]="
              ui.isAllSelected('targetIndustries', ui.targetIndustries())
            "
            (change)="ui.onSelectAll('targetIndustries', ui.targetIndustries())"
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm font-medium text-slate-900">{{
            ui.getSelectAllText("targetIndustries", ui.targetIndustries())
          }}</span>
        </label>

        <!-- Individual Options -->
        @for (industry of ui.targetIndustries(); track industry.value) {
        <label
          class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 cursor-pointer transition"
        >
          <input
            type="checkbox"
            [checked]="
              formState.formData().targetIndustries.includes(industry.value)
            "
            (change)="ui.onMultiSelectChange('targetIndustries', $event)"
            [value]="industry.value"
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm text-slate-900">{{ industry.label }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Business Stages -->
    <div
      class="relative"
      (clickOutside)="ui.closeDropdown('businessStagesOpen')"
    >
      <label class="block text-sm font-semibold text-slate-900 mb-2"
        >Business Stages</label
      >
      <button
        type="button"
        (click)="ui.toggleDropdown('businessStagesOpen')"
        class="w-full flex justify-between items-center px-4 py-2.5 border border-slate-200 rounded-xl bg-white text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
      >
        <span class="truncate text-left">
          {{
            formState.formData().businessStages.length
              ? formState.formData().businessStages.length + " selected"
              : "Select stages"
          }}
        </span>
      </button>

      @if (ui.businessStagesOpen()) {
      <div
        class="absolute z-20 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg p-3 max-h-60 overflow-y-auto"
      >
        <!-- Select All Option -->
        <label
          class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-slate-100 cursor-pointer transition border-b border-slate-200 mb-2"
        >
          <input
            type="checkbox"
            [checked]="ui.isAllSelected('businessStages', ui.businessStages())"
            (change)="ui.onSelectAll('businessStages', ui.businessStages())"
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm font-medium text-slate-900">{{
            ui.getSelectAllText("businessStages", ui.businessStages())
          }}</span>
        </label>

        <!-- Individual Options -->
        @for (stage of ui.businessStages(); track stage.value) {
        <label
          class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 cursor-pointer transition"
        >
          <input
            type="checkbox"
            [checked]="
              formState.formData().businessStages.includes(stage.value)
            "
            (change)="ui.onMultiSelectChange('businessStages', $event)"
            [value]="stage.value"
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm text-slate-900">{{ stage.label }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Geographic Focus -->
    <div class="relative" (clickOutside)="ui.closeDropdown('geoOpen')">
      <label class="block text-sm font-semibold text-slate-900 mb-2"
        >Geographic Focus</label
      >
      <button
        type="button"
        (click)="ui.toggleDropdown('geoOpen')"
        class="w-full flex justify-between items-center px-4 py-2.5 border border-slate-200 rounded-xl bg-white text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
      >
        <span class="truncate text-left">
          {{
            formState.formData().geographicRestrictions.length
              ? formState.formData().geographicRestrictions.length + " selected"
              : "Select regions"
          }}
        </span>
      </button>

      @if (ui.geoOpen()) {
      <div
        class="absolute z-20 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg p-3 max-h-60 overflow-y-auto"
      >
        <!-- Select All Option -->
        <label
          class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-slate-100 cursor-pointer transition border-b border-slate-200 mb-2"
        >
          <input
            type="checkbox"
            [checked]="
              ui.isAllSelected('geographicRestrictions', ui.geographicRegions())
            "
            (change)="
              ui.onSelectAll('geographicRestrictions', ui.geographicRegions())
            "
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm font-medium text-slate-900">{{
            ui.getSelectAllText(
              "geographicRestrictions",
              ui.geographicRegions()
            )
          }}</span>
        </label>

        <!-- Individual Options -->
        @for (region of ui.geographicRegions(); track region.value) {
        <label
          class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 cursor-pointer transition"
        >
          <input
            type="checkbox"
            [checked]="
              formState.formData().geographicRestrictions.includes(region.value)
            "
            (change)="ui.onMultiSelectChange('geographicRestrictions', $event)"
            [value]="region.value"
            class="w-4 h-4 text-teal-600 rounded border-slate-300 focus:ring-teal-500"
          />
          <span class="text-sm text-slate-900">{{ region.label }}</span>
        </label>
        }
      </div>
      }
    </div>
  </div>

  <!-- Revenue Range -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="space-y-2">
      <label class="block text-sm font-semibold text-slate-900"
        >Average Annual Revenue</label
      >
      <input
        type="text"
        placeholder="0"
        [value]="formState.getFormattedAmount('minRevenue')"
        (input)="ui.onNumberInputChange('minRevenue', $event)"
        [class]="ui.getFieldClasses('minRevenue')"
      />
      @if (formState.getFieldError('minRevenue'); as error) {
      <p
        [class.text-red-600]="error.type === 'error'"
        [class.text-amber-600]="error.type === 'warning'"
        class="text-sm"
      >
        {{ error.message }}
      </p>
      }
    </div>

    <div class="space-y-2">
      <label class="block text-sm font-semibold text-slate-900"
        >Minimum Years in Operation</label
      >
      <select
        [value]="formState.formData().minYearsOperation"
        (change)="ui.onFieldChange('minYearsOperation', $event)"
        [class]="ui.getFieldClasses('minYearsOperation')"
      >
        <option value="">No minimum</option>
        <option value="1">1 year</option>
        <option value="2">2 years</option>
        <option value="3">3 years</option>
        <option value="5">5 years</option>
      </select>
      @if (formState.getFieldError('minYearsOperation'); as error) {
      <p
        [class.text-red-600]="error.type === 'error'"
        [class.text-amber-600]="error.type === 'warning'"
        class="text-sm"
      >
        {{ error.message }}
      </p>
      }
    </div>
  </div>

  <!-- Collateral Requirement -->
  <div class="space-y-3">
    <label class="flex items-center space-x-3 cursor-pointer">
      <input
        type="checkbox"
        [checked]="formState.formData().requiresCollateral"
        (change)="ui.onCheckboxChange('requiresCollateral', $event)"
        class="w-4 h-4 text-teal-600 rounded border-slate-300"
      />
      <span class="text-sm font-semibold text-slate-900"
        >Requires Collateral</span
      >
    </label>
  </div>

  <!-- Info Box -->
  <div class="bg-blue-50 border border-blue-200/50 rounded-xl p-4">
    <div class="flex items-start space-x-3">
      <lucide-angular
        [img]="TargetIcon"
        [size]="20"
        class="text-blue-600 mt-0.5"
      ></lucide-angular>
      <div>
        <h4 class="text-sm font-semibold text-blue-900">
          Eligibility Criteria
        </h4>
        <p class="text-sm text-blue-700 mt-1">
          These criteria help match your opportunity with the right businesses.
          More specific criteria mean fewer but more qualified applications.
        </p>
      </div>
    </div>
  </div>
</div>
