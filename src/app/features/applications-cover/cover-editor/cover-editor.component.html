<!-- src/app/features/applications-cover/cover-editor/cover-editor.component.html -->

<div class="flex-1 overflow-y-auto flex flex-col bg-slate-50 max-w-7xl ml-24">
  <div class="px-6 lg:px-8 py-6 flex flex-col flex-1">
    <!-- Header -->
    <div class="mb-8 flex-shrink-0">
      <h2 class="text-3xl font-bold text-slate-900 mb-2">
        {{ isCreating() ? "Create Funding Profile" : "Edit Funding Profile" }}
      </h2>
      <p class="text-slate-600 text-sm">
        {{
          isCreating()
            ? "Set up a custom funding profile"
            : "Update your cover profile requirements"
        }}
      </p>
    </div>

    <!-- ===== VALIDATION ERRORS (NEO-BRUTALIST) ===== -->
    <div
      *ngIf="errors().length > 0"
      class="mb-6 flex-shrink-0 bg-red-50 border-3 border-red-400 rounded-lg p-5"
    >
      <p class="text-xs font-black text-red-700 uppercase tracking-widest mb-3">
        ‚ö†Ô∏è Required Fields
      </p>
      <ul class="space-y-2">
        <li
          *ngFor="let error of errors()"
          class="text-sm font-semibold text-red-700"
        >
          ‚Ä¢ {{ error }}
        </li>
      </ul>
    </div>

    <!-- Form Grid - SCROLLABLE CONTENT -->
    <div class="space-y-6 flex-1">
      <!-- Section 1: Profile Summary -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3
          class="text-base font-semibold text-slate-900 mb-4 uppercase text-xs tracking-wide"
        >
          Profile Summary
        </h3>

        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Profile Name <span class="text-teal-500">*</span>
          </label>
          <input
            type="text"
            [value]="executiveSummary()"
            (change)="updateTextField('executiveSummary', $event)"
            placeholder="e.g., Tech Expansion Round"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
          />
        </div>
      </div>

      <!-- Section 2: Matching Fields (NEO-BRUTALIST) -->
      <div class="bg-white rounded-2xl border-3 border-teal-500 p-6">
        <h3
          class="text-base font-black text-teal-700 mb-5 uppercase tracking-widest flex items-center gap-2"
        >
          <span class="text-lg">üìä</span> Matching Criteria
        </h3>

        <!-- Industries -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-slate-900 mb-3">
            Target Industries <span class="text-teal-500">*</span>
          </label>
          <div class="space-y-3">
            <input
              #industriesInput
              type="text"
              placeholder="Type industry and press Enter"
              (keyup.enter)="addArrayItem('industries', industriesInput)"
              class="w-full px-4 py-2.5 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
            />
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let industry of industries()"
                class="px-3 py-1.5 bg-teal-50 border border-teal-300 rounded-lg text-sm font-medium text-teal-700 flex items-center gap-2"
              >
                {{ industry }}
                <button
                  type="button"
                  (click)="removeArrayItem('industries', industry)"
                  class="text-red-600 hover:text-red-800 font-bold text-lg leading-none"
                >
                  √ó
                </button>
              </span>
            </div>
          </div>
        </div>

        <!-- Funding Amount & Type Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <!-- Funding Amount -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Funding Amount (R) <span class="text-teal-500">*</span>
            </label>
            <input
              type="number"
              [value]="fundingAmount()"
              (change)="updateNumberField('fundingAmount', $event)"
              placeholder="e.g., 500000"
              class="w-full px-4 py-2.5 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
            />
          </div>

          <!-- Funding Types -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Funding Types <span class="text-teal-500">*</span>
            </label>
            <div class="flex flex-wrap gap-2">
              <button
                *ngFor="
                  let type of [
                    'equity',
                    'debt',
                    'grant',
                    'convertible',
                    'mezzanine'
                  ]
                "
                type="button"
                (click)="toggleArrayItem('fundingTypes', type)"
                [class.bg-teal-500]="isItemInArray('fundingTypes', type)"
                [class.text-white]="isItemInArray('fundingTypes', type)"
                [class.border-teal-600]="isItemInArray('fundingTypes', type)"
                [class.font-bold]="isItemInArray('fundingTypes', type)"
                [class.bg-white]="!isItemInArray('fundingTypes', type)"
                [class.text-slate-700]="!isItemInArray('fundingTypes', type)"
                [class.border-slate-200]="!isItemInArray('fundingTypes', type)"
                class="px-3 py-2 border rounded-lg font-medium text-sm uppercase tracking-wide transition-all duration-200 hover:shadow-sm"
              >
                {{ type }}
              </button>
            </div>
          </div>
        </div>

        <!-- Business Stages & Location -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Business Stages -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Business Stages <span class="text-teal-500">*</span>
            </label>
            <div class="flex flex-wrap gap-2">
              <button
                *ngFor="let stage of ['early_stage', 'growth', 'mature']"
                type="button"
                (click)="toggleArrayItem('businessStages', stage)"
                [class.bg-teal-500]="isItemInArray('businessStages', stage)"
                [class.text-white]="isItemInArray('businessStages', stage)"
                [class.font-bold]="isItemInArray('businessStages', stage)"
                [class.bg-white]="!isItemInArray('businessStages', stage)"
                [class.text-slate-700]="!isItemInArray('businessStages', stage)"
                class="px-3 py-1.5 border rounded-lg font-medium text-xs uppercase tracking-widest transition-all duration-200"
              >
                {{ stage }}
              </button>
            </div>
          </div>

          <!-- Location -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Geographic Location <span class="text-teal-500">*</span>
            </label>
            <input
              type="text"
              [value]="location()"
              (change)="updateTextField('location', $event)"
              placeholder="e.g., Cape Town, South Africa"
              class="w-full px-4 py-2.5 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
            />
          </div>
        </div>
      </div>

      <!-- Section 3: Investment Criteria -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3
          class="text-base font-semibold text-slate-900 mb-4 uppercase text-xs tracking-wide"
        >
          üí∞ Investment Requirements
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Must Have Criteria -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-3">
              Required Criteria
            </label>
            <div class="space-y-2">
              <input
                #criteriaInput
                type="text"
                placeholder="Add and press Enter"
                (keyup.enter)="
                  addArrayItem('investmentCriteria', criteriaInput)
                "
                class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
              />
              <div class="flex flex-wrap gap-2">
                <span
                  *ngFor="let criteria of investmentCriteria()"
                  class="px-2.5 py-1 bg-green-50 border border-green-200 rounded-lg text-xs font-semibold text-green-700 flex items-center gap-1.5"
                >
                  ‚úì {{ criteria }}
                  <button
                    type="button"
                    (click)="removeArrayItem('investmentCriteria', criteria)"
                    class="text-red-600 hover:text-red-800 font-bold text-lg leading-none"
                  >
                    √ó
                  </button>
                </span>
              </div>
            </div>
          </div>

          <!-- Exclusions -->
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-3">
              Deal Breakers (Exclusions)
            </label>
            <div class="space-y-2">
              <input
                #exclusionsInput
                type="text"
                placeholder="Add and press Enter"
                (keyup.enter)="
                  addArrayItem('exclusionCriteria', exclusionsInput)
                "
                class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
              />
              <div class="flex flex-wrap gap-2">
                <span
                  *ngFor="let exclusion of exclusionCriteria()"
                  class="px-2.5 py-1 bg-red-50 border border-red-200 rounded-lg text-xs font-semibold text-red-700 flex items-center gap-1.5"
                >
                  ‚úï {{ exclusion }}
                  <button
                    type="button"
                    (click)="removeArrayItem('exclusionCriteria', exclusion)"
                    class="text-red-600 hover:text-red-800 font-bold text-lg leading-none"
                  >
                    √ó
                  </button>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 4: Narrative Content -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3
          class="text-base font-semibold text-slate-900 mb-4 uppercase text-xs tracking-wide"
        >
          Your Story
        </h3>

        <!-- Use of Funds -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            How Will Funds Be Used? <span class="text-teal-500">*</span>
          </label>
          <textarea
            [value]="useOfFunds()"
            (change)="updateTextField('useOfFunds', $event)"
            placeholder="Describe your specific plans (product development, hiring, marketing, etc.)"
            rows="4"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
          ></textarea>
        </div>

        <!-- Repayment Strategy -->
        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Repayment / Exit Strategy
          </label>
          <textarea
            [value]="repaymentStrategy()"
            (change)="updateTextField('repaymentStrategy', $event)"
            placeholder="How will you repay or provide returns to investors?"
            rows="3"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
          ></textarea>
        </div>
      </div>

      <!-- Section 5: Equity Offered (Conditional) -->
      <div
        *ngIf="hasEquityFunding()"
        class="bg-white rounded-2xl border border-slate-200 p-6"
      >
        <h3
          class="text-base font-semibold text-slate-900 mb-4 uppercase text-xs tracking-wide"
        >
          üìà Equity Terms
        </h3>

        <div>
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Equity Percentage (%)
          </label>
          <input
            type="number"
            [value]="equityOffered()"
            (change)="updateNumberField('equityOffered', $event)"
            min="0"
            max="100"
            step="0.5"
            placeholder="e.g., 25"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-200"
          />
        </div>
      </div>

      <!-- Spacer to prevent footer overlap -->
      <div class="py-6"></div>
    </div>
  </div>

  <!-- ===== FOOTER BUTTONS (NEO-BRUTALIST, STICKY) ===== -->
  <div
    class="flex-shrink-0 sticky bottom-0 z-20 bg-white border-t-4 border-slate-300 px-6 lg:px-8 py-4 flex gap-3 justify-end"
  >
    <button
      (click)="onCancel()"
      class="px-5 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl border border-slate-200 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm"
    >
      Cancel
    </button>

    <button
      *ngIf="!isCreating()"
      (click)="uploadDocument.emit(cover!.id)"
      class="px-5 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl border border-slate-200 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm"
      title="Upload pitch deck or financial summary"
    >
      Attach
    </button>

    <button
      (click)="saveChanges()"
      [disabled]="!canSave()"
      [class.opacity-50]="!canSave()"
      [class.cursor-not-allowed]="!canSave()"
      class="px-6 py-2.5 bg-teal-500 text-white font-bold rounded-xl border-2 border-teal-600 hover:bg-teal-600 active:bg-teal-700 transition-all duration-200 text-sm uppercase tracking-wide disabled:opacity-50"
    >
      {{ saving() ? "Saving..." : "Save Profile" }}
    </button>
  </div>
</div>
