<div class="min-h-screen bg-slate-50">
  <!-- Loading State -->
  @if (isLoading()) {
  <div class="flex items-center justify-center h-screen">
    <div class="text-center">
      <div
        class="animate-spin w-12 h-12 border-4 border-teal-200 border-t-teal-500 rounded-full mx-auto mb-4"
      ></div>
      <p class="text-slate-600 font-medium">Loading business profile...</p>
    </div>
  </div>
  } @else if (error()) {
  <div class="max-w-4xl mx-auto px-4 py-16 text-center">
    <div class="bg-red-50 border border-red-200 rounded-2xl p-8">
      <lucide-icon
        [name]="AlertCircleIcon"
        [size]="32"
        class="text-red-600 mx-auto mb-4"
      ></lucide-icon>
      <h1 class="text-2xl font-bold text-slate-900 mb-2">Profile Not Found</h1>
      <p class="text-slate-600">{{ error() }}</p>
    </div>
  </div>
  } @else { @if (profileData()) {
  <div class="max-w-5xl mx-auto px-4 py-8">
    <!-- Header with Company Info & Readiness -->
    <div class="bg-white rounded-2xl border border-slate-200 p-8 mb-8">
      <div class="flex items-start justify-between mb-8">
        <div>
          <h1 class="text-4xl font-bold text-slate-900 mb-2">
            {{ profileData()!.companyName }}
          </h1>
          <div class="flex items-center gap-4 text-slate-600">
            <span class="flex items-center gap-2">
              <lucide-icon [name]="BuildingIcon" [size]="16"></lucide-icon>
              {{ profileData()!.industry }}
            </span>
            <span class="flex items-center gap-2">
              <lucide-icon [name]="CalendarIcon" [size]="16"></lucide-icon>
              {{ profileData()!.yearsInOperation }} years in operation
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-2">
          <button
            (click)="goHome()"
            class="p-2.5 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
            title="Back Home"
          >
            <lucide-icon
              [name]="HomeIcon"
              [size]="20"
              [class.animate-spin]="isRefreshing()"
            ></lucide-icon>
          </button>
          <button
            (click)="refreshProfile()"
            [disabled]="isRefreshing()"
            class="p-2.5 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
            title="Refresh profile"
          >
            <lucide-icon
              [name]="RefreshIcon"
              [size]="20"
              [class.animate-spin]="isRefreshing()"
            ></lucide-icon>
          </button>
          <button
            (click)="shareProfile()"
            class="p-2.5 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
            title="Share profile"
          >
            <lucide-icon [name]="ShareIcon" [size]="20"></lucide-icon>
          </button>
        </div>
      </div>

      <!-- Readiness Assessment Banner -->
      <div
        [class]="
          'rounded-xl border p-6 mb-8 ' +
          getReadinessBadgeClass(readinessLevel())
        "
      >
        <div class="flex items-start justify-between">
          <div>
            <h3 class="font-semibold text-lg mb-1 capitalize">
              {{ readinessLevel() }} Investment Readiness
            </h3>
            <p class="text-sm opacity-90">{{ readinessMessage() }}</p>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold">
              {{ profileData()!.readinessScore
              }}<span class="text-lg">/100</span>
            </div>
          </div>
        </div>

        <!-- Completion Progress -->
        <div class="mt-6">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Profile Completion</span>
            <span class="text-sm font-bold"
              >{{ profileData()!.completionPercentage }}%</span
            >
          </div>
          <div class="w-full h-2 bg-white/30 rounded-full overflow-hidden">
            <div
              [class]="getCompletionColor(profileData()!.completionPercentage)"
              class="h-full rounded-full transition-all duration-700"
              [style.width]="profileData()!.completionPercentage + '%'"
            ></div>
          </div>
        </div>
      </div>

      <!-- Key Metrics Grid -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="p-4 bg-slate-50 rounded-xl">
          <div class="text-xs font-semibold text-slate-600 mb-1">EMPLOYEES</div>
          <div class="text-2xl font-bold text-slate-900">
            {{ profileData()!.employeeCount }}
          </div>
        </div>
        <div class="p-4 bg-slate-50 rounded-xl">
          <div class="text-xs font-semibold text-slate-600 mb-1">
            MONTHLY REVENUE
          </div>
          <div class="text-2xl font-bold text-green-600">
            {{ formatCurrency(profileData()!.monthlyRevenue) }}
          </div>
        </div>
        <div class="p-4 bg-slate-50 rounded-xl">
          <div class="text-xs font-semibold text-slate-600 mb-1">
            FUNDING REQUESTED
          </div>
          <div class="text-2xl font-bold text-teal-600">
            {{ formatCurrency(profileData()!.requestedFunding) }}
          </div>
        </div>
        <div class="p-4 bg-slate-50 rounded-xl">
          <div class="text-xs font-semibold text-slate-600 mb-1">
            LAST UPDATED
          </div>
          <div class="text-xs font-mono text-slate-700 leading-tight">
            {{ formatDate(profileData()!.lastUpdated) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Supporting Documents Section -->
    <div class="mb-12">
      <h2 class="text-2xl font-bold text-slate-900 mb-8">
        Supporting Documents
      </h2>

      @if (profileData()!.documents && profileData()!.documents.length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (doc of profileData()!.documents; track doc.id) {
        <div class="flex gap-4">
          <!-- Icon Container -->
          <div
            class="w-12 h-12 flex-shrink-0 rounded-lg bg-slate-100 flex items-center justify-center"
          >
            <lucide-icon
              [name]="getDocumentIcon(doc.type)"
              [size]="20"
              class="text-slate-600"
            ></lucide-icon>
          </div>

          <!-- Content -->
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-slate-900 text-sm mb-1 truncate">
              {{ doc.name }}
            </h3>
            <p class="text-xs text-slate-500 mb-3">
              {{ formatFileSize(doc.fileSize) }}
            </p>

            <!-- Footer with Status & Download -->
            <div class="flex items-center justify-between gap-2">
              @switch (doc.verificationStatus) { @case ('approved') {
              <span
                class="inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-semibold"
              >
                <lucide-icon [name]="CheckCircleIcon" [size]="12"></lucide-icon>
                <span class="hidden sm:inline">Verified</span>
              </span>
              } @case ('verified') {
              <span
                class="inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-semibold"
              >
                <lucide-icon [name]="CheckCircleIcon" [size]="12"></lucide-icon>
                <span class="hidden sm:inline">Verified</span>
              </span>
              } @case ('rejected') {
              <span
                class="inline-block px-2 py-1 bg-red-50 text-red-700 rounded text-xs font-semibold"
              >
                Rejected
              </span>
              } @case ('processing') {
              <span
                class="inline-block px-2 py-1 bg-amber-50 text-amber-700 rounded text-xs font-semibold"
              >
                Processing
              </span>
              } }
              <a
                [href]="doc.publicUrl"
                target="_blank"
                rel="noopener noreferrer"
                class="text-teal-600 hover:text-teal-700 text-xs font-medium flex items-center gap-0.5"
              >
                Download
                <lucide-icon
                  [name]="ExternalLinkIcon"
                  [size]="12"
                ></lucide-icon>
              </a>
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div
        class="rounded-xl border border-slate-200 bg-slate-50 p-8 text-center"
      >
        <lucide-icon
          [name]="FileTextIcon"
          [size]="32"
          class="text-slate-400 mx-auto mb-3"
        ></lucide-icon>
        <p class="text-slate-600 font-medium text-sm">
          No documents shared yet
        </p>
        <p class="text-slate-500 text-xs mt-1">
          Documents will appear here once they're uploaded and verified
        </p>
      </div>
      }
    </div>

    <!-- Data Room CTA -->
    @if (profileData()!.dataRoomUrl) {
    <div
      class="bg-gradient-to-r from-teal-50 to-cyan-50 rounded-2xl border border-teal-200 p-8 mb-12"
    >
      <div
        class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6"
      >
        <div>
          <h3 class="text-lg font-semibold text-slate-900 mb-2">
            Extended Resources
          </h3>
          <p class="text-slate-600 max-w-xl text-sm">
            Access our complete data room with additional business
            documentation, financial records, and strategic materials.
          </p>
        </div>
        <a
          class="px-8 py-3 bg-teal-600 text-white rounded-xl font-medium hover:bg-teal-700 active:bg-teal-800 transition-colors whitespace-nowrap flex items-center gap-2"
        >
          Visit Data Room
          <lucide-icon [name]="ExternalLinkIcon" [size]="16"></lucide-icon>
        </a>
      </div>
    </div>
    }

    <!-- Business Profile Sections - Multi-Column Layout -->
    <div class="mb-12">
      <h2 class="text-2xl font-bold text-slate-900 mb-8">Business Profile</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (section of profileData()!.sections; track section.stepId) {
        <div class="flex gap-4">
          <!-- Icon Container -->
          <div
            [class]="
              'w-12 h-12 flex-shrink-0 rounded-lg flex items-center justify-center ' +
              (section.completed
                ? 'bg-green-100 text-green-600'
                : 'bg-slate-100 text-slate-400')
            "
          >
            <lucide-icon
              [name]="
                section.completed
                  ? CheckCircleIcon
                  : getSectionIcon(section.stepId)
              "
              [size]="20"
            ></lucide-icon>
          </div>

          <!-- Content -->
          <div class="flex-1">
            <h3 class="font-semibold text-slate-900 text-sm mb-1">
              {{ section.title }}
            </h3>
            <p
              [class]="
                'text-xs mb-3 ' +
                (section.completionPercentage === 100
                  ? 'text-green-600 font-medium'
                  : section.completionPercentage >= 75
                  ? 'text-teal-600'
                  : section.completionPercentage >= 50
                  ? 'text-amber-600'
                  : 'text-slate-500')
              "
            >
              {{ section.completionPercentage }}% complete
            </p>

            <!-- Key Data Items (first 2 only for brevity) -->
            @if (section.keyData.length > 0) {
            <div class="space-y-2">
              @for (item of section.keyData.slice(0, 2); track item.label) {
              <div class="flex items-start gap-2">
                <span class="text-xs text-slate-500 flex-1">{{
                  item.label
                }}</span>
                <span class="text-xs font-medium text-slate-900 text-right">{{
                  item.value
                }}</span>
              </div>
              }
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Request Information Section - Improved CTA -->
    <div
      class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl p-8 mb-12 text-white"
    >
      <div class="max-w-2xl">
        <h3 class="text-2xl font-bold mb-3">Interested in this opportunity?</h3>
        <p class="text-slate-300 mb-6 text-sm leading-relaxed">
          Create an account on Kapify to explore partnership, investment, or
          collaboration opportunities with {{ profileData()!.companyName }} .
          Our platform will facilitate introductions and support the
          conversation.
        </p>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
          <button
            class="px-6 py-3 bg-teal-600 text-white rounded-lg font-medium hover:bg-teal-700 active:bg-teal-800 transition-colors text-sm"
          >
            Request Introduction
          </button>
          <button
            class="px-6 py-3 border border-slate-400 text-white rounded-lg font-medium hover:bg-slate-700 active:bg-slate-600 transition-colors text-sm"
          >
            Save Profile
          </button>
        </div>

        <p class="text-xs text-slate-400">
          We'll notify the business owner of your interest. Response time
          typically within 2-3 business days.
        </p>
      </div>
    </div>

    <!-- Legal Disclaimer - POPIA & GDPR -->
    <div
      class="bg-slate-100 rounded-xl border border-slate-300 p-6 text-center"
    >
      <p class="text-xs text-slate-700 leading-relaxed mb-3">
        <strong>Data Privacy & Compliance Notice:</strong> All information
        displayed on this profile has been voluntarily provided and shared by
        the business owner in accordance with our Platform Terms of Service. By
        accessing this profile, you acknowledge and agree to our data handling
        practices.
      </p>
      <p class="text-xs text-slate-600 leading-relaxed mb-3">
        This platform complies with <strong>POPIA</strong> (Protection of
        Personal Information Act, South Africa) and
        <strong>GDPR</strong> (General Data Protection Regulation, EU). Personal
        information is processed only as authorized by the data subject and in
        accordance with applicable privacy laws. For inquiries regarding your
        data rights or to exercise rights of access, correction, or deletion,
        please contact our Privacy Officer.
      </p>
      <p class="text-xs text-slate-500">
        <span class="block mb-1"
          >Last updated: {{ formatDate(profileData()!.lastUpdated) }}</span
        >
        <span
          >Data reflects information voluntarily shared by the business. The
          platform acts as a neutral intermediary.</span
        >
      </p>
    </div>
  </div>
  } }
</div>
