<!-- src/app/profile/steps/admin-information-step/admin-information.component.html -->
<div class="space-y-6 px-4 lg:px-8">
  <!-- Auto-save Status Header -->
  <div class="bg-white rounded-2xl border border-slate-200 p-4">
    <div class="flex items-center justify-between">
      <div class="text-sm text-slate-600">
        Complete company information for funding assessment
      </div>
      <div class="flex items-center space-x-4">
        <!-- Auto-save status -->
        <div class="flex items-center space-x-2 text-sm">
          @if (isSaving()) {
          <lucide-icon
            [img]="ClockIcon"
            [size]="16"
            class="text-amber-500 animate-spin"
          />
          <span class="text-amber-600">Saving...</span>
          } @else if (lastSaved()) {
          <lucide-icon [img]="SaveIcon" [size]="16" class="text-green-600" />
          <span class="text-green-700">Saved {{ getLastSavedText() }}</span>
          } @else {
          <span class="text-slate-500">Not saved</span>
          }
        </div>
        <!-- Save Button -->
        <ui-button
          variant="outline"
          size="sm"
          (clicked)="saveManually()"
          [disabled]="isSaving()"
        >
          @if (isSaving()) {
          <lucide-icon
            [img]="ClockIcon"
            [size]="16"
            class="mr-2 animate-spin"
          />
          Saving... } @else { Save Now }
        </ui-button>
      </div>
    </div>
  </div>

  <!-- Warning Message -->
  @if (showValidationWarning()) {
  <div class="bg-amber-50 border border-amber-200/50 rounded-xl p-4">
    <div class="flex items-start space-x-3">
      <lucide-icon
        [img]="AlertTriangleIcon"
        [size]="20"
        class="text-amber-600 mt-0.5 flex-shrink-0"
      />
      <div>
        <h4 class="text-sm font-semibold text-amber-900 mb-1">
          Incomplete sections
        </h4>
        <p class="text-sm text-amber-800">
          Some required fields haven't been filled out completely. You can
          proceed to the next section, but you cannot submit without completing
          all required sections.
        </p>
      </div>
      <button
        (click)="dismissWarning()"
        class="text-amber-400 hover:text-amber-600 ml-auto flex-shrink-0"
      >
        ×
      </button>
    </div>
  </div>
  }

  <form [formGroup]="adminForm" class="space-y-6">
    <!-- Contact Details Section -->
    <div class="bg-white rounded-2xl border border-slate-200">
      <button
        type="button"
        (click)="toggleSection('contact')"
        class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-slate-50 transition-colors"
      >
        <div>
          <h3 class="text-lg font-semibold text-slate-900">Contact Details</h3>
          <p class="text-sm text-slate-600 mt-1">
            Please provide details of the person to communicate with regarding
            your company's investor readiness and funding application.
          </p>
        </div>
        <lucide-icon
          [img]="
            getSectionExpanded('contact') ? ChevronUpIcon : ChevronDownIcon
          "
          [size]="20"
          class="text-slate-400 flex-shrink-0"
        />
      </button>

      @if (getSectionExpanded('contact')) {
      <div class="px-6 pb-6 border-t border-slate-200">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
          <ui-input
            label="First name"
            placeholder="Bash"
            [error]="getFieldError('firstName')"
            formControlName="firstName"
            [required]="true"
          />
          <ui-input
            label="Last name"
            placeholder="Cele"
            [error]="getFieldError('lastName')"
            formControlName="lastName"
            [required]="true"
          />
          <ui-input
            label="Email"
            type="email"
            placeholder="bashcele@gmail.com"
            [error]="getFieldError('email')"
            formControlName="email"
            [required]="true"
          />
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Phone number
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <div class="flex">
              <div
                class="flex items-center px-4 py-2.5 border border-r-0 border-slate-200 rounded-l-xl bg-slate-50"
              >
                <img src="/flags/za.svg" alt="ZA" class="w-4 h-4 mr-2" />
                <span class="text-sm text-slate-600">+27</span>
              </div>
              <input
                type="tel"
                placeholder="717496762"
                formControlName="phone"
                class="flex-1 px-4 py-2.5 border border-slate-200 rounded-r-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
              />
            </div>
            @if (getFieldError('phone')) {
            <p class="text-xs font-medium text-red-700 mt-2">
              {{ getFieldError("phone") }}
            </p>
            }
          </div>
          <ui-input
            label="Role"
            placeholder="Finance Director"
            [error]="getFieldError('role')"
            formControlName="role"
            [required]="true"
          />
        </div>
      </div>
      }
    </div>

    <!-- Business Details Section -->
    <div class="bg-white rounded-2xl border border-slate-200">
      <button
        type="button"
        (click)="toggleSection('business')"
        class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-slate-50 transition-colors"
      >
        <div>
          <h3 class="text-lg font-semibold text-slate-900">Business Details</h3>
          <p class="text-sm text-slate-600 mt-1">
            Please provide the requested company details.
          </p>
        </div>
        <lucide-icon
          [img]="
            getSectionExpanded('business') ? ChevronUpIcon : ChevronDownIcon
          "
          [size]="20"
          class="text-slate-400 flex-shrink-0"
        />
      </button>

      @if (getSectionExpanded('business')) {
      <div class="px-6 pb-6 border-t border-slate-200">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
          <ui-input
            label="Name of business"
            placeholder="Senkosi Inc"
            [error]="getFieldError('companyName')"
            formControlName="companyName"
            [required]="true"
          />
          <ui-input
            label="Company Registration Number"
            placeholder="2013/900800/07"
            [error]="getFieldError('registrationNumber')"
            formControlName="registrationNumber"
            [required]="true"
          />
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Telephone Number
            </label>
            <div class="flex">
              <div
                class="flex items-center px-4 py-2.5 border border-r-0 border-slate-200 rounded-l-xl bg-slate-50"
              >
                <img src="/flags/za.svg" alt="ZA" class="w-4 h-4 mr-2" />
                <span class="text-sm text-slate-600">+27</span>
              </div>
              <input
                type="tel"
                placeholder="717496762"
                formControlName="businessPhone"
                class="flex-1 px-4 py-2.5 border border-slate-200 rounded-r-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
              />
            </div>
          </div>
          <ui-input
            label="Years in Operation"
            type="number"
            placeholder="10"
            [error]="getFieldError('yearsInOperation')"
            formControlName="yearsInOperation"
            [required]="true"
          />
        </div>

        <!-- Physical Address -->
        <div class="mt-6 space-y-4">
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Physical address
            </label>
            <div
              class="flex items-center px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50"
            >
              <img src="/flags/za.svg" alt="ZA" class="w-4 h-4 mr-2" />
              <span class="text-sm text-slate-600">South Africa</span>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <ui-input
              label="Address line 1"
              placeholder="290 Action Drive"
              [error]="getFieldError('addressLine1')"
              formControlName="addressLine1"
              [required]="true"
            />
            <ui-input
              label="Address line 2"
              placeholder="Crystal Office Park"
              formControlName="addressLine2"
            />
            <ui-input
              label="Suburb"
              placeholder="Charlestown"
              [error]="getFieldError('suburb')"
              formControlName="suburb"
              [required]="true"
            />
            <ui-input
              label="Province"
              placeholder="Gauteng"
              [error]="getFieldError('province')"
              formControlName="province"
              [required]="true"
            />
            <ui-input
              label="City"
              placeholder="Centurion"
              [error]="getFieldError('city')"
              formControlName="city"
              [required]="true"
            />
            <ui-input
              label="Postal code"
              placeholder="0157"
              [error]="getFieldError('postalCode')"
              formControlName="postalCode"
              [required]="true"
            />
          </div>
        </div>

        <!-- Business Classification -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Industry
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="industry"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select industry</option>
              <option value="energy">Energy</option>
              <option value="agriculture">Agriculture</option>
              <option value="construction">Construction</option>
              <option value="manufacturing">Manufacturing</option>
              <option value="retail">Retail</option>
              <option value="services">Professional Services</option>
              <option value="technology">Technology</option>
              <option value="tourism">Tourism & Hospitality</option>
              <option value="transport">Transport & Logistics</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Business stage
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="businessStage"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select stage</option>
              <option value="startup">Startup</option>
              <option value="growth">Growth Phase</option>
              <option value="established">Established</option>
              <option value="mature">Mature</option>
              <option value="expansion">Expansion</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              BBBEE Level
            </label>
            <select
              formControlName="bbbeeLevel"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select level</option>
              <option value="level1">Level 1</option>
              <option value="level2">Level 2</option>
              <option value="level3">Level 3</option>
              <option value="level4">Level 4</option>
              <option value="level5">Level 5</option>
              <option value="level6">Level 6</option>
              <option value="level7">Level 7</option>
              <option value="level8">Level 8</option>
              <option value="non-compliant">Non-compliant</option>
            </select>
          </div>
          <ui-input
            label="Current staff compliment"
            type="number"
            placeholder="10"
            [error]="getFieldError('staffCount')"
            formControlName="staffCount"
            [required]="true"
          />
        </div>

        <!-- Business Description -->
        <div class="mt-6">
          <label class="block text-sm font-semibold text-slate-900 mb-2">
            Brief Description of the business and activities
            <span class="text-red-600 ml-0.5">*</span>
          </label>
          <textarea
            formControlName="businessDescription"
            rows="4"
            placeholder="Describe your business activities, services, and market focus..."
            class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200 resize-none"
          ></textarea>
          <div class="flex justify-between items-center mt-2">
            @if (getFieldError('businessDescription')) {
            <p class="text-xs font-medium text-red-700">
              {{ getFieldError("businessDescription") }}
            </p>
            } @else {
            <span></span>
            }
            <span class="text-xs text-slate-500">
              {{
                (adminForm.get("businessDescription")?.value || "").length
              }}/500
            </span>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- Legal and Compliance Section -->
    <div class="bg-white rounded-2xl border border-slate-200">
      <button
        type="button"
        (click)="toggleSection('legal')"
        class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-slate-50 transition-colors"
      >
        <div>
          <h3 class="text-lg font-semibold text-slate-900">
            Legal and Compliance
          </h3>
          <p class="text-sm text-slate-600 mt-1">
            Please provide the requested legal and compliance company details.
          </p>
        </div>
        <lucide-icon
          [img]="getSectionExpanded('legal') ? ChevronUpIcon : ChevronDownIcon"
          [size]="20"
          class="text-slate-400 flex-shrink-0"
        />
      </button>

      @if (getSectionExpanded('legal')) {
      <div class="px-6 pb-6 border-t border-slate-200">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              CIPC annual returns
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="cipcReturns"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select status</option>
              <option value="compliant">Compliant</option>
              <option value="outstanding">Outstanding</option>
              <option value="in-progress">In Progress</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Is the Company VAT registered?
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="vatRegistered"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select option</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          @if (adminForm.get('vatRegistered')?.value === 'yes') {
          <ui-input
            label="VAT Number"
            placeholder="4589098765"
            [error]="getFieldError('vatNumber')"
            formControlName="vatNumber"
            [required]="true"
          />
          }

          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Tax compliance status
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="taxCompliance"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select status</option>
              <option value="compliant">Compliant</option>
              <option value="outstanding">Outstanding</option>
              <option value="in-progress">In Progress</option>
            </select>
          </div>

          <ui-input
            label="Income TAX Number"
            type="number"
            placeholder="1234567890"
            [error]="getFieldError('incomeTaxNumber')"
            formControlName="incomeTaxNumber"
            [maxLength]="10"
            [required]="true"
            hint="Exactly 10 digits"
          />

          <div>
            <label class="block text-sm font-semibold text-slate-900 mb-2">
              Workman's compensation
              <span class="text-red-600 ml-0.5">*</span>
            </label>
            <select
              formControlName="workmansComp"
              class="block w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-200"
            >
              <option value="">Select status</option>
              <option value="compliant">Compliant</option>
              <option value="outstanding">Outstanding</option>
              <option value="not-applicable">Not Applicable</option>
            </select>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- Shareholder's Details Section -->
    <div class="bg-white rounded-2xl border border-slate-200">
      <button
        type="button"
        (click)="toggleSection('shareholders')"
        class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-slate-50 transition-colors"
      >
        <div>
          <h3 class="text-lg font-semibold text-slate-900">
            Shareholder's Details
          </h3>
          <p class="text-sm text-slate-600 mt-1">
            Please provide shareholders details as per the current shareholders
            register.
          </p>
        </div>
        <lucide-icon
          [img]="
            getSectionExpanded('shareholders') ? ChevronUpIcon : ChevronDownIcon
          "
          [size]="20"
          class="text-slate-400 flex-shrink-0"
        />
      </button>

      @if (getSectionExpanded('shareholders')) {
      <div class="px-6 pb-6 border-t border-slate-200">
        <div class="mt-4">
          <app-shareholder-manager
            [shareholders]="shareholders()"
            (shareholdersChange)="onShareholdersChange($event)"
          />
        </div>
      </div>
      }
    </div>
  </form>

  <!-- Progress Summary -->
  <div class="bg-white rounded-2xl border border-slate-200 p-4">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="font-semibold text-slate-900">
          Company Information Progress
        </h3>
        <p class="text-sm text-slate-600">
          Data auto-saves every 30 seconds. Manual save available anytime.
        </p>
      </div>

      <div class="flex items-center space-x-4">
        @if (adminForm.valid) {
        <div class="flex items-center space-x-2 text-green-700">
          <div class="w-2 h-2 bg-green-600 rounded-full"></div>
          <span class="font-semibold text-sm">Complete</span>
        </div>
        } @else {
        <div
          class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-semibold"
        >
          Incomplete
        </div>
        }
      </div>
    </div>
  </div>

  <!-- Final auto-save indicator -->
  @if (isSaving()) {
  <div class="text-sm text-slate-500 flex items-center justify-center">
    <div class="w-2 h-2 bg-teal-500 rounded-full animate-pulse mr-2"></div>
    Saving changes...
  </div>
  } @else if (lastSaved()) {
  <div class="text-sm text-slate-500 text-center">
    ✓ Changes saved automatically
  </div>
  }
</div>
