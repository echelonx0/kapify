<!-- src/app/applications/components/new-application/components/opportunity-selector/opportunity-selector.component.html -->
<div class="space-y-6">
  <!-- Header Section -->
  <div class="flex items-center space-x-3 mb-6">
    <div
      class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center"
    >
      <lucide-icon [img]="BuildingIcon" [size]="20" class="text-teal-600" />
    </div>
    <div class="flex-1">
      <h3 class="text-lg font-bold text-slate-900">
        Select Funding Opportunity
      </h3>
      <p class="text-sm text-slate-600">
        Choose the opportunity you want to apply for
      </p>
    </div>
  </div>

  <!-- Search and Filter Bar -->
  <div class="space-y-4 bg-slate-50 p-4 rounded-xl border border-slate-200">
    <!-- Search Input -->
    <div class="relative">
      <input
        type="text"
        placeholder="Search opportunities..."
        [(ngModel)]="filters().searchQuery"
        (ngModelChange)="updateSearchQuery($event)"
        class="w-full pl-9 pr-4 py-2.5 border border-slate-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm text-slate-900 placeholder-slate-400 transition-all duration-200"
      />
    </div>

    <!-- Filter Toggle Button -->
    <div class="flex items-center justify-between">
      <button
        (click)="showFilters.set(!showFilters())"
        class="flex items-center space-x-2 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200 rounded-lg transition-colors duration-200"
      >
        <lucide-icon [img]="FilterIcon" [size]="16" />
        <span>Filters</span>
        @if (hasActiveFilters()) {
        <span
          class="ml-2 px-2.5 py-0.5 bg-teal-100 text-teal-700 text-xs font-semibold rounded-full"
        >
          {{
            filters().fundingType.length +
              (filters().minAmount ? 1 : 0) +
              (filters().maxAmount ? 1 : 0)
          }}
        </span>
        }
      </button>

      @if (hasActiveFilters()) {
      <button
        (click)="clearFilters()"
        class="text-sm text-slate-600 hover:text-slate-900 underline transition-colors duration-200"
      >
        Clear All
      </button>
      }
    </div>

    <!-- Expanded Filters -->
    @if (showFilters()) {
    <div class="space-y-4 pt-4 border-t border-slate-300">
      <!-- Funding Type Filter -->
      <div>
        <label class="block text-sm font-semibold text-slate-900 mb-2"
          >Funding Type</label
        >
        <div class="flex flex-wrap gap-2">
          @for (type of availableFundingTypes(); track type) {
          <button
            (click)="toggleFundingTypeFilter(type)"
            [class.ring-2]="filters().fundingType.includes(type)"
            [class.ring-teal-500]="filters().fundingType.includes(type)"
            [class.bg-teal-50]="filters().fundingType.includes(type)"
            [class.border-teal-300]="filters().fundingType.includes(type)"
            class="px-3 py-1.5 text-sm font-medium border border-slate-200 rounded-full hover:border-teal-400 transition-all duration-200"
          >
            {{ formatFundingType(type) }}
            @if (filters().fundingType.includes(type)) {
            <span class="ml-1 text-teal-600">✓</span>
            }
          </button>
          }
        </div>
      </div>

      <!-- Amount Range Filter -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label
            for="minAmount"
            class="block text-sm font-semibold text-slate-900 mb-2"
            >Min Amount</label
          >
          <input
            id="minAmount"
            type="number"
            placeholder="0"
            [value]="filters().minAmount || ''"
            (change)="updateMinAmount($any($event.target).value)"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm text-slate-900 placeholder-slate-400 transition-all duration-200"
          />
        </div>
        <div>
          <label
            for="maxAmount"
            class="block text-sm font-semibold text-slate-900 mb-2"
            >Max Amount</label
          >
          <input
            id="maxAmount"
            type="number"
            placeholder="No limit"
            [value]="filters().maxAmount || ''"
            (change)="updateMaxAmount($any($event.target).value)"
            class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm text-slate-900 placeholder-slate-400 transition-all duration-200"
          />
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="text-center py-12">
    <div
      class="animate-spin w-8 h-8 border-2 border-teal-500 border-t-transparent rounded-full mx-auto mb-4"
    ></div>
    <p class="text-slate-600 font-medium">Loading opportunities...</p>
  </div>
  } @else if (opportunities().length === 0) {
  <!-- Empty State -->
  <div class="text-center py-12">
    <div
      class="w-16 h-16 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-4"
    >
      <lucide-icon [img]="AlertCircleIcon" [size]="32" class="text-slate-400" />
    </div>
    <p class="text-slate-900 mb-2 font-semibold">
      No active opportunities available
    </p>
    <p class="text-slate-600 text-sm mb-4">
      Check back later for new funding opportunities
    </p>
    <button
      (click)="goBack()"
      class="text-teal-600 hover:text-teal-700 font-medium text-sm transition-colors duration-200"
    >
      ← Browse Other Options
    </button>
  </div>
  } @else if (filteredOpportunities().length === 0) {
  <!-- No Filtered Results -->
  <div class="text-center py-12">
    <div
      class="w-16 h-16 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-4"
    >
      <lucide-icon [img]="AlertCircleIcon" [size]="32" class="text-slate-400" />
    </div>
    <p class="text-slate-900 mb-2 font-semibold">
      No opportunities match your filters
    </p>
    <p class="text-slate-600 text-sm mb-4">
      Try adjusting your search criteria
    </p>
    <button
      (click)="clearFilters()"
      class="text-teal-600 hover:text-teal-700 font-medium text-sm transition-colors duration-200"
    >
      Clear Filters
    </button>
  </div>
  } @else {
  <!-- Opportunities List -->
  <div class="space-y-3">
    @for (opportunity of filteredOpportunities(); track opportunity.id) {
    <div
      class="border rounded-2xl p-5 cursor-pointer transition-all duration-200 group"
      [class.border-teal-500]="selectedOpportunityId() === opportunity.id"
      [class.bg-teal-50]="selectedOpportunityId() === opportunity.id"
      [class.shadow-md]="selectedOpportunityId() === opportunity.id"
      [class.border-slate-200]="selectedOpportunityId() !== opportunity.id"
      [class.bg-white]="selectedOpportunityId() !== opportunity.id"
      [class.hover:shadow-md]="selectedOpportunityId() !== opportunity.id"
      [class.hover:border-slate-300]="
        selectedOpportunityId() !== opportunity.id
      "
      (click)="selectOpportunity(opportunity)"
    >
      <!-- Main Content -->
      <div class="flex justify-between items-start mb-3">
        <div class="flex-1">
          <h4 class="font-bold text-slate-900 text-base">
            {{ opportunity.title }}
          </h4>
          <p class="text-sm text-slate-600 mt-1">
            {{ opportunity.shortDescription }}
          </p>
        </div>

        <!-- Selection Indicator -->
        @if (selectedOpportunityId() === opportunity.id) {
        <div class="ml-4 flex-shrink-0">
          <lucide-icon
            [img]="CheckCircleIcon"
            [size]="24"
            class="text-teal-600"
          />
        </div>
        }
      </div>

      <!-- Funding Type Pills -->
      <div class="flex flex-wrap gap-2 mb-3">
        @if (isArrayFundingType(opportunity.fundingType)) { @for (type of
        $any(opportunity.fundingType); track type) {
        <span
          class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold"
          [class]="getFundingTypeColor(type)"
        >
          {{ formatFundingType(type) }}
        </span>
        } } @else {
        <span
          class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold"
          [class]="getFundingTypeColor(opportunity.fundingType)"
        >
          {{ formatFundingType(opportunity.fundingType) }}
        </span>
        }
      </div>

      <!-- Key Metrics -->
      <div
        class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-3 pb-3 border-b border-slate-200"
      >
        <div>
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Investment Range
          </p>
          <p class="text-sm font-medium text-slate-900 mt-0.5">
            {{ getInvestmentRangeDisplay(opportunity) }}
          </p>
        </div>
        <div>
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Decision Time
          </p>
          <p class="text-sm font-medium text-slate-900 mt-0.5">
            {{ opportunity.decisionTimeframe }} days
          </p>
        </div>
        <div>
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Funder
          </p>
          <p class="text-sm font-medium text-slate-900 mt-0.5">
            {{ getOrganizationName(opportunity) }}
          </p>
        </div>
        <div>
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Risk Level
          </p>
          <p
            [class]="getRiskIndicator(opportunity).color"
            class="text-sm font-medium mt-0.5"
          >
            {{ getRiskIndicator(opportunity).level }}
          </p>
        </div>
      </div>

      <!-- Eligibility Summary -->
      @if (getEligibilitySummary(opportunity).length > 0) {
      <div class="space-y-1">
        @for (criteria of getEligibilitySummary(opportunity); track criteria) {
        <p class="text-xs text-slate-600">✓ {{ criteria }}</p>
        }
      </div>
      }
    </div>
    }
  </div>

  <!-- Results Summary -->
  <div class="text-center text-sm text-slate-600 mt-4">
    @if (hasActiveFilters()) {
    <p>
      Showing {{ filteredOpportunities().length }} of
      {{ opportunities().length }} opportunities
    </p>
    } @else {
    <p>{{ opportunities().length }} opportunities available</p>
    }
  </div>
  }
</div>
