<div class="flex flex-col h-full bg-slate-50">
  <!-- ===== HEADER ===== -->
  <div
    class="flex-shrink-0 bg-white border-b border-slate-200 px-8 py-6 flex items-center justify-between animate-in fade-in slide-in-from-top-2 duration-500"
  >
    <div>
      <h1 class="text-3xl font-bold text-slate-900">Funding Profiles</h1>
      <p class="text-sm text-slate-600 mt-1">
        Organize and manage your funding profiles
      </p>
    </div>
    <button
      (click)="navigateBack.emit()"
      class="flex items-center gap-2 px-6 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm hover:scale-105 active:scale-95"
      title="Go back"
    >
      Back
    </button>
  </div>

  <!-- ===== EMPTY STATE ===== -->
  <div
    *ngIf="covers.length === 0"
    class="flex-1 flex items-center justify-center"
  >
    <div class="text-center py-20 animate-in fade-in zoom-in-50 duration-700">
      <div
        class="w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-xl flex items-center justify-center mx-auto mb-6"
      ></div>
      <h3 class="text-xl font-bold text-slate-900 mb-2">
        No funding profiles yet
      </h3>
      <p class="text-slate-600">
        Create your first profile to match with opportunities
      </p>
    </div>
  </div>

  <!-- ===== TABLE VIEW ===== -->
  <div
    *ngIf="covers.length > 0"
    class="ml-8 mr-4 flex-1 overflow-x-auto overflow-y-auto"
  >
    <table class="w-full border-collapse">
      <!-- Table Header -->
      <thead class="bg-white sticky top-0 z-10 border-b border-slate-200">
        <tr class="animate-in fade-in duration-500">
          <th class="px-6 py-4 text-left">
            <span
              class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
            >
              Profile
            </span>
          </th>
          <th class="px-6 py-4 text-left">
            <span
              class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
            >
              Sectors
            </span>
          </th>
          <th class="px-6 py-4 text-left">
            <span
              class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
            >
              Amount
            </span>
          </th>
          <th class="px-6 py-4 text-left">
            <span
              class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
            >
              Completion
            </span>
          </th>
          <th class="px-6 py-4 text-center">
            <span
              class="text-xs font-semibold text-slate-600 uppercase tracking-wider"
            >
              Actions
            </span>
          </th>
        </tr>
      </thead>

      <!-- Table Body -->
      <tbody class="divide-y divide-slate-200">
        <ng-container
          *ngFor="let cover of covers; let i = index; trackBy: trackById"
        >
          <!-- Main Row -->
          <tr
            class="bg-white transition-all duration-300 hover:bg-slate-50 border-l-4 group animate-in fade-in slide-in-from-left-4"
            [style.animation-delay.ms]="i * 50"
            [class.border-l-teal-500]="isDefault(cover)"
            [class.border-l-slate-200]="!isDefault(cover)"
          >
            <!-- Profile Name + Default Badge -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="flex-1 min-w-0">
                  <p
                    class="font-semibold text-slate-900 truncate group-hover:text-teal-600 transition-colors duration-200"
                  >
                    {{ cover.executiveSummary || "Untitled Profile" }}
                  </p>
                  <p class="text-xs text-slate-500 mt-1">
                    Created {{ formatDate(cover.createdAt) }}
                  </p>
                </div>
                <span
                  *ngIf="isDefault(cover)"
                  class="flex-shrink-0 px-2.5 py-1 bg-teal-50 text-teal-700 rounded-full text-xs font-semibold border border-teal-200/50 animate-pulse"
                >
                  Default
                </span>
              </div>
            </td>

            <!-- Sectors - Improved Presentation -->
            <td class="px-6 py-4">
              <div class="flex flex-wrap gap-1.5 max-w-xs">
                <span
                  *ngFor="
                    let sector of cover.industries.slice(0, 2);
                    let i = index
                  "
                  class="px-3 py-1.5 bg-gradient-to-r from-teal-50 to-teal-100/50 text-teal-700 rounded-lg text-xs font-medium border border-teal-200/50 whitespace-nowrap shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 animate-in fade-in slide-in-from-bottom-1"
                  [style.animation-delay.ms]="i * 75"
                >
                  {{ sector }}
                </span>
                <span
                  *ngIf="cover.industries.length > 2"
                  class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-xs font-semibold border border-slate-200 animate-in fade-in"
                >
                  +{{ cover.industries.length - 2 }}
                </span>
              </div>
            </td>

            <!-- Amount -->
            <td class="px-6 py-4">
              <p
                class="font-semibold text-teal-600 text-sm group-hover:text-teal-700 transition-colors duration-200"
              >
                {{ formatCurrency(cover.fundingAmount) }}
              </p>
            </td>

            <!-- Completion Progress -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3 min-w-0">
                <div
                  class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden shadow-inner"
                >
                  <div
                    class="h-full bg-gradient-to-r from-teal-400 via-teal-500 to-teal-600 rounded-full transition-all duration-1000 ease-out shadow-lg"
                    [style.width.%]="getCompletionPercentage(cover)"
                  ></div>
                </div>
                <p
                  class="font-semibold text-slate-900 text-sm flex-shrink-0 w-10 text-right"
                >
                  {{ getCompletionPercentage(cover) }}%
                </p>
              </div>
            </td>

            <!-- View Details Button -->
            <td class="px-6 py-4 text-center">
              <button
                (click)="toggleRow(cover.id)"
                class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-50 text-teal-700 font-medium rounded-lg hover:bg-teal-100 active:bg-teal-200 transition-all duration-200 text-sm hover:scale-110 active:scale-95"
                [attr.aria-label]="
                  'View details for ' + (cover.executiveSummary || 'Untitled')
                "
              >
                <span>{{ expandedRow() === cover.id ? "Hide" : "View" }}</span>
                <span
                  class="inline-block transition-transform duration-300"
                  [class.rotate-180]="expandedRow() === cover.id"
                >
                  ▼
                </span>
              </button>
            </td>
          </tr>

          <!-- Expanded Row with Details & Actions -->
          <tr
            *ngIf="expandedRow() === cover.id"
            class="bg-slate-50 border-b border-slate-200 animate-in fade-in slide-in-from-top-2 duration-400"
          >
            <td [attr.colspan]="5" class="px-6 py-6">
              <div class="space-y-6">
                <!-- Document Status Badge -->
                <div
                  *ngIf="cover.coverDocumentUrl"
                  class="inline-flex items-center gap-2 px-3 py-2 bg-green-50 border border-green-200/50 rounded-lg animate-in fade-in slide-in-from-left-2 duration-500"
                >
                  <span class="text-xs font-medium text-green-700"
                    >● Document attached</span
                  >
                </div>

                <!-- Profile Preview Grid -->
                <div
                  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 py-6 border-y border-slate-200"
                >
                  <!-- Funding Types -->
                  <div
                    class="animate-in fade-in slide-in-from-bottom-4 duration-500"
                    style="animation-delay: 50ms"
                  >
                    <p
                      class="text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3"
                    >
                      Funding Types
                    </p>
                    <div class="flex flex-wrap gap-1.5">
                      <span
                        *ngFor="
                          let type of cover.fundingTypes.slice(0, 2);
                          let i = index
                        "
                        class="px-3 py-1.5 bg-white text-slate-700 rounded-lg text-xs font-medium border border-slate-200 hover:border-teal-300 hover:bg-teal-50 transition-all duration-200 hover:scale-105 animate-in fade-in"
                        [style.animation-delay.ms]="i * 100"
                      >
                        {{ type }}
                      </span>
                      <span
                        *ngIf="cover.fundingTypes.length > 2"
                        class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-xs font-semibold border border-slate-200 animate-in fade-in"
                      >
                        +{{ cover.fundingTypes.length - 2 }}
                      </span>
                    </div>
                  </div>

                  <!-- Business Stages -->
                  <div
                    class="animate-in fade-in slide-in-from-bottom-4 duration-500"
                    style="animation-delay: 100ms"
                  >
                    <p
                      class="text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3"
                    >
                      Business Stages
                    </p>
                    <div class="flex flex-wrap gap-1.5">
                      <span
                        *ngFor="
                          let stage of cover.businessStages.slice(0, 2);
                          let i = index
                        "
                        class="px-3 py-1.5 bg-white text-slate-700 rounded-lg text-xs font-medium border border-slate-200 hover:border-teal-300 hover:bg-teal-50 transition-all duration-200 hover:scale-105 animate-in fade-in"
                        [style.animation-delay.ms]="i * 100"
                      >
                        {{ stage }}
                      </span>
                      <span
                        *ngIf="cover.businessStages.length > 2"
                        class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-xs font-semibold border border-slate-200 animate-in fade-in"
                      >
                        +{{ cover.businessStages.length - 2 }}
                      </span>
                    </div>
                  </div>

                  <!-- Location -->
                  <div
                    class="animate-in fade-in slide-in-from-bottom-4 duration-500"
                    style="animation-delay: 150ms"
                  >
                    <p
                      class="text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3"
                    >
                      Location
                    </p>
                    <p
                      class="text-sm font-medium text-slate-900 px-3 py-1.5 bg-white border border-slate-200 rounded-lg inline-block"
                    >
                      {{ cover.location || "—" }}
                    </p>
                  </div>

                  <!-- Investor Profiles -->
                  <div
                    class="animate-in fade-in slide-in-from-bottom-4 duration-500"
                    style="animation-delay: 200ms"
                  >
                    <p
                      class="text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3"
                    >
                      Investor Focus
                    </p>
                    <p
                      class="text-sm font-medium text-slate-900 px-3 py-1.5 bg-white border border-slate-200 rounded-lg inline-block"
                    >
                      {{
                        cover.investmentCriteria.length > 0
                          ? cover.investmentCriteria.length + " profiles"
                          : "—"
                      }}
                    </p>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div
                  class="flex flex-wrap gap-2 animate-in fade-in slide-in-from-bottom-4 duration-500"
                  style="animation-delay: 250ms"
                >
                  <!-- Edit (Primary) -->
                  <button
                    (click)="editCover.emit(cover.id)"
                    class="flex items-center justify-center gap-2 px-4 py-2.5 bg-teal-500 text-white font-medium rounded-xl hover:bg-teal-600 active:bg-teal-700 transition-all duration-200 text-sm hover:shadow-lg hover:scale-105 active:scale-95"
                  >
                    Edit
                  </button>

                  <!-- Set Default (Secondary) -->
                  <button
                    *ngIf="!isDefault(cover)"
                    (click)="setDefault.emit(cover.id)"
                    class="flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm hover:scale-105 active:scale-95"
                  >
                    Set as Default
                  </button>

                  <!-- Upload/Update Document (Secondary) -->
                  <button
                    (click)="uploadDocument.emit(cover.id)"
                    class="flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm hover:scale-105 active:scale-95"
                  >
                    {{ cover.coverDocumentUrl ? "Update" : "Upload" }} Document
                  </button>

                  <!-- Copy (Secondary) -->
                  <button
                    (click)="copyCover.emit(cover.id)"
                    class="flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 text-sm hover:scale-105 active:scale-95"
                  >
                    Duplicate
                  </button>

                  <!-- Delete (Danger, if not default) -->
                  <button
                    *ngIf="!isDefault(cover)"
                    (click)="deleteCover.emit(cover.id)"
                    class="flex items-center justify-center gap-2 px-4 py-2.5 bg-red-50 text-red-600 font-medium rounded-xl hover:bg-red-100 active:bg-red-200 transition-all duration-200 text-sm hover:scale-105 active:scale-95"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
