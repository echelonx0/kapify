<div class="min-h-screen bg-slate-50">
  <!-- Page Container -->
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6 lg:py-8">
    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-slate-900">Applications Report</h1>
      <p class="text-sm text-slate-600 mt-1">
        Generate and export detailed reports of your applications
      </p>
    </div>

    <!-- Error Alert -->
    @if (error()) {
    <div
      class="mb-6 bg-red-50 border border-red-200/50 rounded-xl p-4 flex items-start gap-3"
    >
      <svg
        class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <div class="flex-1">
        <p class="text-sm font-medium text-red-900">{{ error() }}</p>
      </div>
      <button
        (click)="error.set(null)"
        class="text-red-600 hover:text-red-700 transition-colors duration-200"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
    }

    <!-- Field Selector Card -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm mb-6">
      <!-- Card Header -->
      <div class="px-6 py-4 border-b border-slate-200">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold text-slate-900">
              Select Report Fields
            </h2>
            <p class="text-xs text-slate-600 mt-0.5">
              Choose which fields to include in your report
            </p>
          </div>
          <div class="flex items-center gap-2">
            <button
              (click)="selectAll()"
              class="text-sm text-teal-600 hover:text-teal-700 font-medium transition-colors duration-200"
            >
              Select All
            </button>
            <span class="text-slate-300">|</span>
            <button
              (click)="deselectAll()"
              class="text-sm text-slate-600 hover:text-slate-700 font-medium transition-colors duration-200"
            >
              Clear All
            </button>
          </div>
        </div>
      </div>

      <!-- Card Content -->
      <div class="px-6 py-4">
        <!-- Field Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
          @for (field of fields; track trackByKey($index, field)) {
          <label
            class="flex items-center gap-2 text-sm text-slate-700 cursor-pointer hover:text-slate-900 transition-colors duration-200"
          >
            <input
              type="checkbox"
              class="w-4 h-4 rounded border-slate-300 text-teal-500 focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 transition-all duration-200"
              [checked]="selectedFields().includes(field.key)"
              (change)="toggleField(field.key)"
            />
            <span>{{ field.label }}</span>
          </label>
          }
        </div>

        <!-- Action Buttons -->
        <div
          class="flex items-center justify-between pt-4 border-t border-slate-200"
        >
          <div class="text-sm text-slate-600">
            <span class="font-medium text-slate-900">{{
              selectedFields().length
            }}</span>
            of {{ fields.length }} fields selected
          </div>
          <button
            (click)="saveDefault()"
            [disabled]="!hasSelectedFields()"
            class="px-6 py-2.5 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 active:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
          >
            Save as Default View
          </button>
        </div>
      </div>
    </div>

    <!-- Report Actions Card -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm mb-6">
      <div class="px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div>
            <p class="text-sm font-semibold text-slate-900">
              {{ rowCount() }}
              {{ rowCount() === 1 ? "Application" : "Applications" }}
            </p>
            <p class="text-xs text-slate-600">
              Showing {{ displayedColumns().length }} columns
            </p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <!-- Refresh Button -->
          <button
            (click)="refresh()"
            [disabled]="loading()"
            class="px-4 py-2.5 text-slate-600 font-medium rounded-xl hover:bg-slate-100 active:bg-slate-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              [class.animate-spin]="loading()"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            <span>Refresh</span>
          </button>

          <!-- Export Excel Button -->
          <button
            (click)="exportExcel()"
            [disabled]="
              !hasSelectedFields() || rowCount() === 0 || exporting() !== null
            "
            class="px-6 py-2.5 bg-teal-500 text-white font-medium rounded-xl hover:bg-teal-600 active:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2"
          >
            @if (exporting() === 'excel') {
            <svg
              class="w-4 h-4 animate-spin"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            <span>Exporting...</span>
            } @else {
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <span>Export Excel</span>
            }
          </button>

          <!-- Export PDF Button -->
          <button
            (click)="exportPDF()"
            [disabled]="
              !hasSelectedFields() || rowCount() === 0 || exporting() !== null
            "
            class="px-6 py-2.5 bg-slate-700 text-white font-medium rounded-xl hover:bg-slate-800 active:bg-slate-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2"
          >
            @if (exporting() === 'pdf') {
            <svg
              class="w-4 h-4 animate-spin"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            <span>Exporting...</span>
            } @else {
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
              />
            </svg>
            <span>Export PDF</span>
            }
          </button>
        </div>
      </div>
    </div>

    <!-- Report Table Card -->
    <div
      class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden"
    >
      @if (loading()) {
      <!-- Loading State -->
      <div class="px-6 py-12 text-center">
        <svg
          class="w-12 h-12 text-teal-500 animate-spin mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          />
        </svg>
        <p class="text-base font-medium text-slate-900">
          Loading applications...
        </p>
        <p class="text-sm text-slate-600 mt-1">
          Please wait while we fetch your data
        </p>
      </div>
      } @else if (rowCount() === 0) {
      <!-- Empty State -->
      <div class="px-6 py-12 text-center">
        <svg
          class="w-16 h-16 text-slate-300 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
        <h3 class="text-lg font-semibold text-slate-900 mb-1">
          No Applications Found
        </h3>
        <p class="text-sm text-slate-600 mb-4">
          There are no applications to display in your report.
        </p>
        <button
          (click)="refresh()"
          class="px-6 py-2.5 bg-teal-500 text-white font-medium rounded-xl hover:bg-teal-600 active:bg-teal-700 transition-colors duration-200"
        >
          Refresh Data
        </button>
      </div>
      } @else if (!hasSelectedFields()) {
      <!-- No Fields Selected -->
      <div class="px-6 py-12 text-center">
        <svg
          class="w-16 h-16 text-amber-400 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>
        <h3 class="text-lg font-semibold text-slate-900 mb-1">
          No Fields Selected
        </h3>
        <p class="text-sm text-slate-600">
          Please select at least one field to display in the report.
        </p>
      </div>
      } @else {
      <!-- Data Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200">
          <!-- Table Header -->
          <thead class="bg-slate-50">
            <tr>
              @for (col of displayedColumns(); track trackByKey($index, col)) {
              <th
                scope="col"
                class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap"
              >
                {{ col.label }}
              </th>
              }
            </tr>
          </thead>

          <!-- Table Body -->
          <tbody class="bg-white divide-y divide-slate-200">
            @for (row of data(); track trackByIndex($index)) {
            <tr class="hover:bg-slate-50 transition-colors duration-200">
              @for (col of displayedColumns(); track trackByKey($index, col)) {
              <td class="px-4 py-3 text-sm text-slate-900 whitespace-nowrap">
                @if (row[col.key] !== undefined && row[col.key] !== null &&
                row[col.key] !== '') {
                {{ row[col.key] }}
                } @else {
                <span class="text-slate-400">â€”</span>
                }
              </td>
              }
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Table Footer -->
      <div class="px-6 py-4 bg-slate-50 border-t border-slate-200">
        <p class="text-sm text-slate-600">
          Showing
          <span class="font-medium text-slate-900">{{ rowCount() }}</span>
          {{ rowCount() === 1 ? "application" : "applications" }}
        </p>
      </div>
      }
    </div>
  </div>
</div>
