<!-- src/app/shared/components/modal/action-modal.component.html -->

<!-- Modal Backdrop -->
@if (modalService.isOpen()) {
<div
  class="fixed inset-0 bg-black/25 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300"
  (click)="modalService.cancel()"
  [@fadeInOut]
>
  <!-- Modal Container -->
  <div
    class="bg-white rounded-2xl shadow-lg max-w-md w-full transform transition-all duration-300"
    (click)="$event.stopPropagation()"
    [@slideUp]
  >
    <!-- ====================================
         DELETE/DUPLICATE/WITHDRAW CONFIRMATION
         ==================================== -->
    @if (isConfirmationModal()) {
    <div class="p-6 space-y-6" [class]="'bg-' + getColorScheme() + '-50'">
      <!-- Icon -->
      <div class="flex justify-center">
        <div
          class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0"
          [class]="'bg-' + getColorScheme() + '-100'"
        >
          @if (modalService.actionType() === 'delete') {
          <lucide-icon
            [img]="AlertIcon"
            [size]="24"
            [class]="'text-' + getColorScheme() + '-600'"
          />
          } @else if (modalService.actionType() === 'withdraw') {
          <lucide-icon
            [img]="AlertIcon"
            [size]="24"
            [class]="'text-' + getColorScheme() + '-600'"
          />
          } @else {
          <lucide-icon
            [img]="AlertIcon"
            [size]="24"
            [class]="'text-' + getColorScheme() + '-600'"
          />
          }
        </div>
      </div>

      <!-- Title & Message -->
      <div class="text-center space-y-2">
        <h2 class="text-lg font-bold text-slate-900">
          @if (modalService.actionType() === 'delete') { Delete "{{
            modalService.data().opportunityTitle
          }}"? } @else if (modalService.actionType() === 'duplicate') { Create
          Copy of "{{ modalService.data().opportunityTitle }}"? } @else if
          (modalService.actionType() === 'withdraw') { Withdraw Application? }
          @else if (modalService.actionType() === 'warning') {
          {{ modalService.data().title }}
          }
        </h2>

        <p class="text-sm text-slate-600 leading-relaxed">
          @if (modalService.actionType() === 'delete') { @if
          (modalService.data().hasApplications) {
          <span>
            This opportunity has
            <strong>{{ modalService.data().applicationCount }}</strong>
            active applications. These will not be deleted, but you'll lose
            access to this opportunity.
          </span>
          } @else {
          <span>
            This action cannot be undone. The opportunity and all associated
            data will be permanently deleted.
          </span>
          } } @else if (modalService.actionType() === 'duplicate') { A complete
          copy of this opportunity will be created with the same settings and
          requirements. } @else if (modalService.actionType() === 'withdraw') {
          <span>
            You're about to withdraw your application @if
            (modalService.data().message) {
            <strong>({{ modalService.data().message }})</strong>
            }. You can reapply anytime.
          </span>
          } @else if (modalService.actionType() === 'warning') {
          {{ modalService.data().subtitle }}
          }
        </p>
      </div>

      <!-- Error Message (if any) -->
      @if (modalService.errorMessage()) {
      <div
        class="px-4 py-3 rounded-xl bg-red-50 border border-red-200/50 flex items-start gap-3"
      >
        <lucide-icon
          [img]="AlertIcon"
          [size]="18"
          class="text-red-600 flex-shrink-0 mt-0.5"
        />
        <p class="text-sm text-red-700">{{ modalService.errorMessage() }}</p>
      </div>
      }

      <!-- Action Buttons -->
      <div class="flex items-center gap-3 pt-2">
        <!-- Cancel Button -->
        <button
          type="button"
          (click)="modalService.cancel()"
          [disabled]="modalService.isLoading()"
          class="flex-1 px-4 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 active:bg-slate-100 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2"
        >
          Cancel
        </button>

        <!-- Confirm Button -->
        <button
          type="button"
          (click)="modalService.confirm()"
          [disabled]="modalService.isLoading()"
          [class]="
            'flex-1 px-4 py-2.5 text-sm font-medium text-white rounded-xl transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center gap-2 ' +
            'bg-' +
            getColorScheme() +
            '-600 hover:bg-' +
            getColorScheme() +
            '-700 active:bg-' +
            getColorScheme() +
            '-800 focus:ring-' +
            getColorScheme() +
            '-500'
          "
        >
          @if (modalService.isLoading()) {
          <div
            class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"
          ></div>
          <span>Processing...</span>
          } @else {
          <span>{{ modalService.getActionButtonText() }}</span>
          }
        </button>
      </div>
    </div>
    }

    <!-- ====================================
         SUCCESS STATE
         ==================================== -->
    @else if (modalService.isSuccessState()) {
    <div class="p-6 space-y-6">
      <!-- Icon -->
      <div class="flex justify-center">
        <div
          class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0"
        >
          <lucide-icon [img]="CheckIcon" [size]="24" class="text-green-600" />
        </div>
      </div>

      <!-- Title & Message -->
      <div class="text-center space-y-2">
        <h2 class="text-lg font-bold text-slate-900">
          @if (modalService.actionType() === 'withdraw-success') { Application
          Withdrawn } @else if (modalService.actionType() === 'publish-success')
          { Opportunity Published } @else if (modalService.actionType() ===
          'success') {
          {{ modalService.data().title }}
          } @else { Success }
        </h2>

        <p class="text-sm text-slate-600 leading-relaxed">
          @if (modalService.actionType() === 'withdraw-success') {
          {{ modalService.data().message }}
          } @else if (modalService.actionType() === 'publish-success') { "{{
            modalService.data().opportunityTitle
          }}" is now live and visible to eligible SMEs. } @else {
          {{ modalService.data().subtitle }}
          }
        </p>
      </div>

      <!-- Action Button -->
      <button
        type="button"
        (click)="modalService.success()"
        class="w-full px-4 py-2.5 text-sm font-medium text-white bg-green-600 rounded-xl hover:bg-green-700 active:bg-green-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
      >
        {{ modalService.data().actionText || "Continue" }}
      </button>
    </div>
    }

    <!-- ====================================
         ERROR STATE
         ==================================== -->
    @else if (modalService.isErrorState()) {
    <div class="p-6 space-y-6">
      <!-- Icon -->
      <div class="flex justify-center">
        <div
          class="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center flex-shrink-0"
        >
          <lucide-icon [img]="AlertIcon" [size]="24" class="text-red-600" />
        </div>
      </div>

      <!-- Title & Message -->
      <div class="text-center space-y-2">
        <h2 class="text-lg font-bold text-slate-900">
          @if (modalService.actionType() === 'withdraw-error') { Unable to
          Withdraw } @else if (modalService.actionType() === 'publish-error') {
          Publication Failed } @else if (modalService.actionType() === 'error')
          {
          {{ modalService.data().title }}
          } @else { Error }
        </h2>

        <p class="text-sm text-slate-600 leading-relaxed">
          @if (modalService.actionType() === 'withdraw-error') {
          {{ modalService.data().errorMessage }}
          } @else if (modalService.actionType() === 'publish-error') { There was
          an issue publishing "{{ modalService.data().opportunityTitle }}".
          {{ modalService.data().errorMessage }}
          } @else {
          {{ modalService.data().subtitle }}
          }
        </p>

        <!-- Additional Error Details -->
        @if (modalService.data().errorMessage && modalService.actionType() ===
        'error') {
        <div class="mt-3 p-3 bg-red-50 border border-red-200/50 rounded-lg">
          <p class="text-xs text-red-700">
            {{ modalService.data().errorMessage }}
          </p>
        </div>
        }
      </div>

      <!-- Action Button -->
      <button
        type="button"
        (click)="modalService.success()"
        class="w-full px-4 py-2.5 text-sm font-medium text-white bg-red-600 rounded-xl hover:bg-red-700 active:bg-red-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
      >
        {{ modalService.data().actionText || "Got it" }}
      </button>
    </div>
    }

    <!-- ====================================
         INFO STATE
         ==================================== -->
    @else if (modalService.actionType() === 'info') {
    <div class="p-6 space-y-6">
      <!-- Icon -->
      <div class="flex justify-center">
        <div
          class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0"
        >
          <svg
            class="w-6 h-6 text-blue-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </div>
      </div>

      <!-- Title & Message -->
      <div class="text-center space-y-2">
        <h2 class="text-lg font-bold text-slate-900">
          {{ modalService.data().title }}
        </h2>
        <p class="text-sm text-slate-600 leading-relaxed">
          {{ modalService.data().subtitle }}
        </p>
      </div>

      <!-- Action Button -->
      <button
        type="button"
        (click)="modalService.success()"
        class="w-full px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-xl hover:bg-blue-700 active:bg-blue-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        {{ modalService.data().actionText || "Got it" }}
      </button>
    </div>
    }

    <!-- ====================================
         WARNING STATE
         ==================================== -->
    @else if (modalService.actionType() === 'warning') {
    <div class="p-6 space-y-6">
      <!-- Icon -->
      <div class="flex justify-center">
        <div
          class="w-12 h-12 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0"
        >
          <lucide-icon [img]="AlertIcon" [size]="24" class="text-amber-600" />
        </div>
      </div>

      <!-- Title & Message -->
      <div class="text-center space-y-2">
        <h2 class="text-lg font-bold text-slate-900">
          {{ modalService.data().title }}
        </h2>
        <p class="text-sm text-slate-600 leading-relaxed">
          {{ modalService.data().subtitle }}
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center gap-3 pt-2">
        <button
          type="button"
          (click)="modalService.cancel()"
          [disabled]="modalService.isLoading()"
          class="flex-1 px-4 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 active:bg-slate-100 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2"
        >
          {{ modalService.data().cancelText || "Cancel" }}
        </button>

        <button
          type="button"
          (click)="modalService.confirm()"
          [disabled]="modalService.isLoading()"
          class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-amber-600 rounded-xl hover:bg-amber-700 active:bg-amber-800 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 flex items-center justify-center gap-2"
        >
          @if (modalService.isLoading()) {
          <div
            class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"
          ></div>
          <span>Processing...</span>
          } @else {
          <span>{{ modalService.data().actionText || "Understood" }}</span>
          }
        </button>
      </div>
    </div>
    }
  </div>
</div>
}
