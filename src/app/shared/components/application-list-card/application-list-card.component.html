<!-- src/app/shared/components/application-list-card/application-list-card.component.html -->
<div
  class="bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden cursor-pointer"
  (click)="viewDetails.emit(application)"
>
  <!-- Status Accent Bar -->
  <div
    class="h-1.5 bg-gradient-to-r transition-all duration-200"
    [class]="getStatusAccentClass()"
  ></div>

  <!-- Main Content -->
  <div class="p-6 space-y-5">
    <!-- Header: Title + Status Badge + Actions -->
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <!-- Title -->
        <h3 class="text-base font-bold text-slate-900 mb-2 truncate">
          {{ application.title }}
        </h3>

        <!-- Metadata Row: Application Number + Stage -->
        <div class="flex items-center gap-3 text-xs text-slate-600">
          @if (application.applicationNumber) {
          <div class="flex items-center gap-1">
            <svg
              class="w-3.5 h-3.5 text-slate-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
              ></path>
            </svg>
            <span class="font-mono">{{ application.applicationNumber }}</span>
          </div>
          } @if (application.currentStage) {
          <div class="w-px h-3 bg-slate-300"></div>
          <span class="font-medium text-slate-700">{{
            application.currentStage
          }}</span>
          }
        </div>
      </div>

      <!-- Status Badge -->
      <div class="flex items-center gap-2 flex-shrink-0">
        <span
          class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold whitespace-nowrap"
          [class]="statusBadgeClass()"
        >
          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd"
            ></path>
          </svg>
          {{ statusText() }}
        </span>
      </div>
    </div>

    <!-- Funding Types Tags -->
    @if (getFundingTypeTags().length > 0) {
    <div class="flex flex-wrap gap-2">
      @for (fundingType of getFundingTypeTags(); track fundingType) {
      <span
        class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium"
        [class]="getFundingTypeColor(fundingType)"
      >
        {{ fundingType }}
      </span>
      }
    </div>
    }

    <!-- Description -->
    @if (application.description) {
    <p class="text-sm text-slate-600 leading-relaxed line-clamp-2">
      {{ application.description }}
    </p>
    }

    <!-- Details Grid: 3 columns with icons -->
    <div class="grid grid-cols-3 gap-4 pt-4 border-t border-slate-200">
      <!-- Amount -->
      <div class="flex items-start gap-3">
        <div
          class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center flex-shrink-0"
        >
          <svg
            class="w-5 h-5 text-green-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </div>
        <div class="min-w-0">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Amount
          </p>
          <p class="text-sm font-bold text-slate-900 mt-1">
            {{
              formatCurrency(application.requestedAmount, application.currency)
            }}
          </p>
        </div>
      </div>

      <!-- Date -->
      <div class="flex items-start gap-3">
        <div
          class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0"
        >
          <svg
            class="w-5 h-5 text-blue-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
            ></path>
          </svg>
        </div>
        <div class="min-w-0">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            {{ dateLabel() }}
          </p>
          <p class="text-sm font-bold text-slate-900 mt-1">
            {{ formatDate(dateValue()) }}
          </p>
        </div>
      </div>

      <!-- Context-specific Column: Applicant or Opportunity -->
      @if (userType === 'funder' && (application.applicantCompany ||
      application.applicantName)) {
      <div class="flex items-start gap-3">
        <div
          class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center flex-shrink-0"
        >
          <svg
            class="w-5 h-5 text-orange-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5.581m0 0H9m5.581 0a2 2 0 100-4 2 2 0 000 4zM9 7h6m0 0a3 3 0 11-6 0 3 3 0 016 0zm6 0a3 3 0 11-6 0 3 3 0 016 0z"
            ></path>
          </svg>
        </div>
        <div class="min-w-0">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Applicant
          </p>
          <p class="text-sm font-bold text-slate-900 truncate mt-1">
            {{ application.applicantCompany || application.applicantName }}
          </p>
        </div>
      </div>
      } @if (userType === 'sme' && application.opportunityTitle) {
      <div class="flex items-start gap-3">
        <div
          class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center flex-shrink-0"
        >
          <svg
            class="w-5 h-5 text-orange-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5m0 0l-5 5m5-5H6"
            ></path>
          </svg>
        </div>
        <div class="min-w-0">
          <p
            class="text-xs font-semibold text-slate-600 uppercase tracking-wide"
          >
            Opportunity
          </p>
          <p class="text-sm font-bold text-slate-900 truncate mt-1">
            {{ application.opportunityTitle }}
          </p>
        </div>
      </div>
      }
    </div>

    <!-- Progress Bar -->
    @if (showProgress && application.status !== 'draft') {
    <div class="pt-4 border-t border-slate-200">
      <div class="flex items-center justify-between mb-3">
        <p class="text-xs font-semibold text-slate-600 uppercase tracking-wide">
          Progress
        </p>
        <span
          class="text-xs font-bold text-slate-900 bg-slate-100 px-2 py-1 rounded-lg"
          >{{ getProgress() }}%</span
        >
      </div>
      <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
        <div
          class="h-full bg-gradient-to-r from-orange-400 to-orange-500 rounded-full transition-all duration-700 ease-out"
          [style.width.%]="getProgress()"
        ></div>
      </div>
    </div>
    }

    <!-- Action Buttons Row (Bottom) -->
    <!-- @if (canWithdraw()) { -->
    <div class="flex items-center justify-end gap-2 pt-2">
      <button
        type="button"
        (click)="withdrawApplication()"
        [disabled]="appManagementService.isUpdating()"
        class="px-3 py-1.5 text-xs font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        title="Withdraw application"
      >
        Withdraw
      </button>
      <ng-content select="[slot=actions]"></ng-content>
    </div>
    <!-- } @if (!canWithdraw()) { -->
    <ng-content select="[slot=actions]"></ng-content>
    <!-- } -->
  </div>
</div>
